import{r as v,E as ae,o as d,c as ie,w as N,b as e,g as r,j as s,e as q,v as H,q as Z,t as n,a as i,i as B,n as z,x as we,F as Y,h as G,m as Je,H as Ke,L as Qe,f as le,k as ke}from"./app.451846d1.js";import{_ as We}from"./AuthenticatedLayout.5a7f27bb.js";import{M as se}from"./Modal.3c90ec94.js";import{_ as f}from"./InputLabel.d8b30b1e.js";import{_ as j}from"./TextInput.e9195246.js";import{q as de}from"./VueSearchSelect.fcbadd8d.js";/* empty css                        */import{a as D}from"./index.5f970893.js";import{t as $e}from"./trash.1666e19f.js";import{e as Xe}from"./edit.ab06a793.js";/* empty css                                              */const Ze={class:"space-y-4"},et={__name:"ModalEditInternalSale",props:{show:Boolean,sale:Object,clients:Array},emits:["close","update"],setup($,{emit:y}){const S=$,U=y,u=v({id:null,client_id:null,client_name:"",client_phone:"",car_id:null,car_name:"",car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",sale_date:""}),k=v(!1);function w(){const m=new Date,g=m.getFullYear(),o=String(m.getMonth()+1).padStart(2,"0"),c=String(m.getDate()).padStart(2,"0");return`${g}-${o}-${c}`}function V(m){if(!m)return w();try{if(typeof m=="string"&&m.includes("T"))return m.split("T")[0];const g=new Date(m);if(isNaN(g.getTime()))return m;const o=g.getFullYear(),c=String(g.getMonth()+1).padStart(2,"0"),x=String(g.getDate()).padStart(2,"0");return`${o}-${c}-${x}`}catch{return m}}ae(()=>S.sale,m=>{m&&(u.value={id:m.id,client_id:m.client_id,car_id:m.car_id,car_name:m.car?`${m.car.car_type} ${m.car.year} - ${m.car.vin||m.car.car_number}`:"",car_price:m.car_price||0,shipping:m.shipping||0,sale_price:m.sale_price,paid_amount:m.paid_amount,expenses:m.expenses,additional_expenses:m.additional_expenses||0,note:m.note||"",sale_date:V(m.sale_date||m.created_at),client_name:"",client_phone:""},k.value=!1)},{deep:!0,immediate:!0});function I(){U("update",u.value)}function _(){U("close")}return(m,g)=>(d(),ie(se,{show:$.show,onClose:_},{header:N(()=>[g[11]||(g[11]=e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u062A\u0639\u062F\u064A\u0644 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Ze,[e("div",null,[r(f,{for:"edit_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644"}),r(s(de),{modelValue:u.value.client_id,"onUpdate:modelValue":g[0]||(g[0]=o=>u.value.client_id=o),list:$.clients,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644...",class:"dark:bg-gray-800 dark:text-gray-100"},null,8,["modelValue","list"])]),e("div",null,[r(f,{for:"car_display_edit",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),r(j,{id:"car_display_edit",type:"text",modelValue:u.value.car_name,"onUpdate:modelValue":g[1]||(g[1]=o=>u.value.car_name=o),class:"mt-1 block w-full bg-gray-100 dark:bg-gray-800 cursor-not-allowed text-gray-500 dark:text-gray-400",disabled:""},null,8,["modelValue"])]),e("div",null,[q(e("input",{type:"hidden","onUpdate:modelValue":g[2]||(g[2]=o=>u.value.car_id=o)},null,512),[[H,u.value.car_id]])]),e("div",null,[r(f,{for:"edit_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),r(j,{id:"edit_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":g[3]||(g[3]=o=>u.value.car_price=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[q(e("input",{type:"hidden","onUpdate:modelValue":g[4]||(g[4]=o=>u.value.shipping=o)},null,512),[[H,u.value.shipping]])]),e("div",null,[r(f,{for:"edit_sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),r(j,{id:"edit_sale_price",type:"number",step:"0.01",modelValue:u.value.sale_price,"onUpdate:modelValue":g[5]||(g[5]=o=>u.value.sale_price=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"edit_paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),r(j,{id:"edit_paid_amount",type:"number",step:"0.01",modelValue:u.value.paid_amount,"onUpdate:modelValue":g[6]||(g[6]=o=>u.value.paid_amount=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"edit_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),r(j,{id:"edit_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":g[7]||(g[7]=o=>u.value.expenses=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"edit_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),r(j,{id:"edit_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":g[8]||(g[8]=o=>u.value.additional_expenses=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"edit_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),r(j,{id:"edit_sale_date",type:"date",modelValue:u.value.sale_date,"onUpdate:modelValue":g[9]||(g[9]=o=>u.value.sale_date=o),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"edit_note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),q(e("textarea",{id:"edit_note","onUpdate:modelValue":g[10]||(g[10]=o=>u.value.note=o),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"},null,512),[[H,u.value.note]])])])]),footer:N(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:_,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:I,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u062D\u062F\u064A\u062B ")])]),_:1},8,["show"]))}},tt={class:"text-xl font-bold dark:text-gray-100"},lt={key:0,class:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},at={class:"text-sm space-y-1"},st={class:"flex justify-between"},rt={class:"font-medium"},ot={class:"flex justify-between"},nt={class:"font-medium text-green-600"},dt={class:"flex justify-between font-bold text-lg pt-2 border-t"},it={class:"text-red-600"},ut={class:"space-y-4"},ct={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},pt={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},gt={class:"flex justify-end gap-2"},mt=["disabled"],bt=["disabled"],yt={key:0},xt={key:1},_t={__name:"ModalAddPayment",props:{show:Boolean,buyer:Object,merchantId:[String,Number],isLoading:Boolean},emits:["close","confirm"],setup($,{emit:y}){const S=$,U=y,u=v(0),k=v(""),w=v(""),V=Z(()=>!S.buyer||!S.buyer.remaining_debt?0:Math.abs(S.buyer.remaining_debt)),I=Z(()=>{const o=parseFloat(u.value)||0;return o<=0?(w.value="\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0635\u0641\u0631",!1):o>V.value?(w.value=`\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A (${_(V.value)} $)`,!1):(w.value="",!0)});ae(()=>S.show,o=>{o&&(u.value=0,k.value="",w.value="")}),ae(u,()=>{u.value?I.value:w.value=""});function _(o){return o==null?"0":(typeof o=="number"?o:parseFloat(o)||0).toFixed(2).replace(/\.00$/,"")}function m(){U("close")}function g(){!I.value||U("confirm",{amount:parseFloat(u.value)||0,note:k.value||""})}return(o,c)=>(d(),ie(se,{show:$.show,onClose:m},{header:N(()=>{var x;return[e("h2",tt,"\u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 - "+n((x=$.buyer)==null?void 0:x.name),1)]}),body:N(()=>[$.buyer?(d(),i("div",lt,[e("div",at,[e("div",st,[c[2]||(c[2]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",rt,n(_($.buyer.total_sales))+" $",1)]),e("div",ot,[c[3]||(c[3]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",nt,n(_($.buyer.total_paid))+" $",1)]),e("div",dt,[c[4]||(c[4]=e("span",{class:"text-red-600"},"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):",-1)),e("span",it,n(_(Math.abs($.buyer.remaining_debt)))+" $",1)])])])):B("",!0),e("div",ut,[e("div",null,[r(f,{for:"payment_amount",value:"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639 ($)"}),r(j,{id:"payment_amount",type:"number",step:"0.01",min:"0",modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=x=>u.value=x),max:V.value,placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639",class:z(["mt-1 block w-full",w.value?"border-red-500 focus:border-red-500 focus:ring-red-500":""])},null,8,["modelValue","max","class"]),w.value?(d(),i("p",ct,n(w.value),1)):(d(),i("p",pt," \u0627\u0644\u062D\u062F \u0627\u0644\u0623\u0642\u0635\u0649: "+n(_(V.value))+" $ ",1))]),e("div",null,[r(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),q(e("textarea",{id:"payment_note","onUpdate:modelValue":c[1]||(c[1]=x=>k.value=x),rows:"3",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[H,k.value]])])])]),footer:N(()=>[e("div",gt,[e("button",{onClick:m,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",disabled:$.isLoading}," \u0625\u0644\u063A\u0627\u0621 ",8,mt),e("button",{onClick:g,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:$.isLoading||!I.value||!u.value||u.value<=0},[$.isLoading?(d(),i("span",yt,"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...")):(d(),i("span",xt,"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639"))],8,bt)])]),_:1},8,["show"]))}},vt={class:"text-xl font-bold dark:text-gray-100"},ft={key:0,class:"text-center py-4"},ht={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},kt={key:2,class:"overflow-x-auto"},wt={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},$t={class:"px-2 py-3"},Vt={class:"px-2 py-3"},Ct={class:"px-2 py-3 font-mono text-xs"},St={class:"px-2 py-3 text-green-600 font-bold"},Ut={class:"px-2 py-3"},jt={class:"px-2 py-3 text-sm"},Ft={class:"px-2 py-3"},It=["onClick"],Mt={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},Bt={class:"px-2 py-3 text-green-600"},Et={__name:"ModalPaymentDetails",props:{show:Boolean,buyer:Object,merchantId:[String,Number]},emits:["close","refresh"],setup($,{emit:y}){const S=we(),U=$,u=y,k=v([]),w=v(!1);ae(()=>U.show,o=>{o&&U.buyer&&U.merchantId?_():k.value=[]});function V(o){return o==null?"0":(typeof o=="number"?o:parseFloat(o)||0).toFixed(2).replace(/\.00$/,"")}function I(o){if(!o)return"-";try{if(typeof o=="string"&&o.includes("T"))return o.split("T")[0];const c=new Date(o);if(isNaN(c.getTime()))return o;const x=c.getFullYear(),A=String(c.getMonth()+1).padStart(2,"0"),W=String(c.getDate()).padStart(2,"0");return`${x}-${A}-${W}`}catch{return o}}async function _(){if(!(!U.buyer||!U.merchantId)){w.value=!0;try{const o=await D.get("/api/getBuyerPaymentDetails",{params:{buyer_id:U.buyer.id,merchant_id:U.merchantId}});k.value=o.data.payments||[]}catch(o){console.error("Error loading payment details:",o),k.value=[],S.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{w.value=!1}}}async function m(o){var c,x;if(!!confirm(`\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0642\u064A\u0645\u0629 ${V(o.amount)} $\u061F`))try{await D.post("/api/deletePayment",{sale_id:o.sale_id,payment_id:o.id}),S.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),await _(),u("refresh")}catch(A){console.error("Error deleting payment:",A),S.error(((x=(c=A.response)==null?void 0:c.data)==null?void 0:x.error)||"\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function g(){u("close")}return(o,c)=>(d(),ie(se,{show:$.show,onClose:g},{header:N(()=>{var x;return[e("h2",vt,"\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 - "+n((x=$.buyer)==null?void 0:x.name),1)]}),body:N(()=>[w.value?(d(),i("div",ft,[...c[0]||(c[0]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):k.value.length===0?(d(),i("div",ht," \u0644\u0627 \u062A\u0648\u062C\u062F \u062F\u0641\u0639\u0627\u062A \u0645\u0633\u062C\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646 ")):(d(),i("div",kt,[e("table",wt,[c[3]||(c[3]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},[e("tr",null,[e("th",{class:"px-2 py-3"},"#"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A"),e("th",{class:"px-2 py-3"},"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0629"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(d(!0),i(Y,null,G(k.value,(x,A)=>{var W,p,ee,M;return d(),i("tr",{key:x.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",$t,n(A+1),1),e("td",Vt,n((W=x.car)==null?void 0:W.car_type)+" "+n((p=x.car)==null?void 0:p.year),1),e("td",Ct,n(((ee=x.car)==null?void 0:ee.vin)||((M=x.car)==null?void 0:M.car_number)||"-"),1),e("td",St,n(V(x.amount))+" $",1),e("td",Ut,n(I(x.date)),1),e("td",jt,n(x.note||"-"),1),e("td",Ft,[e("button",{onClick:re=>m(x),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600",title:"\u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629"},[r($e,{class:"w-4 h-4 inline"})],8,It)])])}),128))]),k.value.length>0?(d(),i("tfoot",Mt,[e("tr",null,[c[1]||(c[1]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u062F\u0641\u0639\u0627\u062A:",-1)),e("td",Bt,n(V(k.value.reduce((x,A)=>x+(parseFloat(A.amount)||0),0)))+" $ ",1),c[2]||(c[2]=e("td",{colspan:"3"},null,-1))])])):B("",!0)])]))]),footer:N(()=>[e("div",{class:"flex justify-end"},[e("button",{onClick:g,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u063A\u0644\u0627\u0642 ")])]),_:1},8,["show"]))}},Nt={class:"text-xl font-bold dark:text-gray-100"},Tt={class:"space-y-4"},Dt={__name:"ModalBulkEditInternalSales",props:{show:Boolean,selectedCount:Number},emits:["close","confirm"],setup($,{emit:y}){const S=$,U=y,u=v({car_price:null,expenses:null,additional_expenses:null});ae(()=>S.show,V=>{V&&(u.value={car_price:null,expenses:null,additional_expenses:null})});function k(){U("close")}function w(){U("confirm",{car_price:u.value.car_price!==null?parseFloat(u.value.car_price):null,expenses:u.value.expenses!==null?parseFloat(u.value.expenses):null,additional_expenses:u.value.additional_expenses!==null?parseFloat(u.value.additional_expenses):null})}return(V,I)=>(d(),ie(se,{show:$.show,onClose:k},{header:N(()=>[e("h2",Nt,"\u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ("+n($.selectedCount)+" \u0645\u0628\u064A\u0639\u0629)",1)]),body:N(()=>[I[3]||(I[3]=e("div",{class:"mb-4 text-sm text-gray-600 dark:text-gray-400"}," \u0633\u064A\u062A\u0645 \u062A\u0637\u0628\u064A\u0642 \u0627\u0644\u0642\u064A\u0645 \u0627\u0644\u0645\u062F\u062E\u0644\u0629 \u0639\u0644\u0649 \u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629. \u0627\u062A\u0631\u0643 \u0627\u0644\u062D\u0642\u0644 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647. ",-1)),e("div",Tt,[e("div",null,[r(f,{for:"bulk_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),r(j,{id:"bulk_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":I[0]||(I[0]=_=>u.value.car_price=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"bulk_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),r(j,{id:"bulk_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":I[1]||(I[1]=_=>u.value.expenses=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"bulk_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),r(j,{id:"bulk_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":I[2]||(I[2]=_=>u.value.additional_expenses=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:N(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:k,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:w,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062D\u0641\u0638 \u0627\u0644\u062A\u0639\u062F\u064A\u0644\u0627\u062A ")])]),_:1},8,["show"]))}},At={class:"flex justify-between items-center"},Pt={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},Lt={class:"max-w-9xl mx-auto sm:px-6 lg:px-8 p-6 dark:bg-gray-900"},Ot={class:"overflow-hidden shadow-sm sm:rounded-lg"},Yt={class:"mb-4 flex items-center justify-between"},qt={class:"flex items-center gap-4"},Ht={class:"flex items-center cursor-pointer"},Rt={class:"relative"},zt=["checked"],Gt={key:0,class:"mb-6"},Jt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"},Kt={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},Qt={class:"flex items-center justify-between"},Wt={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Xt={class:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4"},Zt={class:"flex items-center justify-between"},el={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},tl={class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},ll={class:"flex items-center justify-between"},al={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},sl={class:"flex items-center justify-between"},rl={class:"text-2xl font-bold text-red-600 dark:text-red-400"},ol={key:0,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700"},nl={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},dl={class:"text-sm text-gray-600 dark:text-gray-400"},il={class:"text-lg font-bold text-gray-800 dark:text-gray-200"},ul={key:1,class:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800"},cl={class:"flex justify-between items-center mb-4"},pl={class:"text-lg font-bold dark:text-green-300"},gl={key:0,class:"text-center py-4"},ml={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},bl={key:2,class:"overflow-x-auto max-h-96 overflow-y-auto"},yl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},xl={class:"px-2 py-3 font-medium"},_l={class:"px-2 py-3"},vl={class:"px-2 py-3"},fl={class:"font-mono text-xs"},hl={key:0,class:"text-xs text-gray-500"},kl={class:"px-2 py-3 font-bold"},wl={class:"px-2 py-3"},$l=["onClick"],Vl={key:2,class:"mt-4"},Cl={key:0,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Sl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ul={class:"flex justify-between items-center mb-2"},jl={key:0},Fl={key:1},Il={key:0,class:"relative"},Ml={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},Bl={key:0},El={class:"md:col-span-2"},Nl={key:1,class:"text-center py-10"},Tl={key:2,class:"overflow-x-auto shadow-md sm:rounded-lg"},Dl={key:0,class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 flex justify-between items-center"},Al={class:"text-blue-700 dark:text-blue-300 font-medium"},Pl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},Ll={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},Ol={class:"px-2 py-3 print:hidden"},Yl=["checked"],ql={class:"px-2 py-3 print:hidden"},Hl=["checked","onChange"],Rl={class:"px-2 py-3"},zl={class:"px-2 py-3 font-medium"},Gl={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Jl={class:"px-2 py-3"},Kl={class:"px-2 py-3 font-mono text-xs"},Ql={class:"px-2 py-3"},Wl={class:"px-2 py-3"},Xl={class:"px-2 py-3"},Zl={class:"px-2 py-3"},ea={class:"px-2 py-3"},ta={class:"px-2 py-3"},la={class:"px-2 py-3"},aa={key:0,class:"mb-1"},sa={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},ra={class:"px-2 py-3 print:hidden"},oa=["onClick"],na=["onClick"],da={key:0,class:"bg-gray-100 dark:bg-gray-800"},ia={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},ua={class:"px-2 py-3"},ca={class:"px-2 py-3"},pa={class:"px-2 py-3"},ga={class:"px-2 py-3"},ma={class:"px-2 py-3"},ba={key:3,class:"mb-6 mt-6"},ya={key:0,class:"text-center py-4"},xa={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},_a={class:"flex justify-between items-start mb-3"},va={class:"font-bold text-lg text-gray-800 dark:text-gray-200"},fa={class:"text-sm text-gray-500 dark:text-gray-400"},ha={class:"space-y-2 text-sm"},ka={class:"flex justify-between"},wa={class:"font-medium"},$a={class:"flex justify-between"},Va={class:"font-medium text-green-600"},Ca={class:"border-t pt-2 mt-2 flex justify-between items-center font-bold text-lg"},Sa={class:"mt-3 pt-3 border-t"},Ua={class:"flex gap-2"},ja=["onClick"],Fa=["onClick"],Ia={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ma={class:"space-y-4"},Ba={class:"flex justify-between items-center mb-2"},Ea={key:0},Na={key:1},Ta={key:0,class:"relative"},Da={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},Aa={key:0,class:"text-center py-4"},Pa={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},La={key:2,class:"max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-2"},Oa={class:"flex-1"},Ya={class:"font-medium"},qa={class:"text-xs text-gray-500 dark:text-gray-400 mr-2"},Ha={class:"text-xs text-blue-600 dark:text-blue-400"},Ra=["onClick","disabled"],za={key:0},Ga={class:"space-y-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3"},Ja={class:"flex justify-between items-start mb-2"},Ka={class:"font-medium"},Qa={class:"text-xs text-gray-500 dark:text-gray-400"},Wa=["onClick"],Xa={class:"grid grid-cols-2 gap-2 mt-2"},Za={class:"flex justify-end gap-2"},cs={__name:"InternalSales",props:{url:String,client_id:String,client:Object,clients:Array},setup($){let y=we();const S=$;let U=v(!1),u=v(!1),k=v([]),w=v({}),V=v(!1),I=v(!1),_=v([]),m=v(!1),g=v([]),o=v(!1),c=v(!1),x=v([]),A=v(!1),W=v(null),p=v({}),ee=v(null),M=v([]),re=v(!1),ue=v(!1),ce=v(!1),L=v(null),pe=v(!1),ge=v(!1),h=v({client_id:null,client_name:"",client_phone:"",cars:[],sale_date:"",showNewClientForm:!1});const E=Z(()=>{var a;return S.client_id||((a=S.client)==null?void 0:a.id)}),J=Z(()=>{const a=k.value,t={};a.forEach(P=>{var te;const T=((te=P.car)==null?void 0:te.car_type)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F";t[T]||(t[T]=0),t[T]++});const l=x.value.reduce((P,T)=>P+(T.remaining_debt>0?T.remaining_debt:0),0),b=w.value.total_sales||0,C=(w.value.total_expenses||0)+a.reduce((P,T)=>P+(parseFloat(T.additional_expenses)||0),0),Q=w.value.total_profit||0;return{carTypes:Object.entries(t).map(([P,T])=>({type:P,count:T})),totalDebt:l,totalSales:b,totalExpenses:C,totalProfit:Q,totalCarsSold:a.length}}),me=Z(()=>_.value.length>0?_.value.map(a=>({value:a.id,text:`${a.car_type||""} ${a.year||""} - ${a.vin||a.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"}`,vin:a.vin||"",car_number:a.car_number||"",car_type:a.car_type||"",year:a.year||"",total_s:a.total_s||0,car_price:a.car_price||0})):[]),xe=Z(()=>g.value.length>0?g.value.map(a=>({value:a.id,text:`${a.name||""}${a.phone?" - "+a.phone:""}`,name:a.name||"",phone:a.phone||""})):[]);function Ve(){const a=me.value.find(t=>t.value===p.value.car_id);if(a){p.value.car_price=0;const t=a.total_s;p.value.shipping=0;let l=t;if(!t||t===0){const b=_.value.find(C=>C.id===p.value.car_id);b&&b.total_s&&(l=b.total_s)}p.value.expenses=l||0}}function X(){const a=new Date,t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),b=String(a.getDate()).padStart(2,"0");return`${t}-${l}-${b}`}function Ce(a){if(!a)return"-";try{if(typeof a=="string"&&a.includes("T"))return a.split("T")[0];const t=new Date(a);if(isNaN(t.getTime()))return a;const l=t.getFullYear(),b=String(t.getMonth()+1).padStart(2,"0"),C=String(t.getDate()).padStart(2,"0");return`${l}-${b}-${C}`}catch{return a}}function F(a){return a==null?"0":(typeof a=="number"?a:parseFloat(a)||0).toFixed(2).replace(/\.00$/,"")}async function K(){if(!!E.value){m.value=!0,_.value=[];try{const a=await D.get("/api/getUnsoldCars",{params:{client_id:E.value}});a.data&&a.data.cars&&Array.isArray(a.data.cars)&&(_.value=a.data.cars)}catch(a){console.error("Error loading unsold cars:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{m.value=!1}}}async function O(){if(!!E.value){I.value=!0;try{const a=await D.get("/api/getInternalSales",{params:{client_id:E.value}});k.value=a.data.sales||[],w.value=a.data.totals||{},V.value=a.data.has_internal_sales||!1,a.data.client&&(W.value=a.data.client)}catch(a){console.error("Error loading internal sales:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{I.value=!1}}}async function R(){A.value=!0;try{const a=await D.get("/api/getInternalSalesBuyers",{params:{client_id:E.value}});x.value=a.data.buyers||[]}catch(a){console.error("Error loading internal sales buyers:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0632\u0628\u0627\u0626\u0646",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{A.value=!1}}async function oe(){if(!!E.value){o.value=!0;try{const a=await D.get("/api/getAllClients",{params:{client_id:E.value}});a.data&&a.data.clients?g.value=a.data.clients:S.clients&&Array.isArray(S.clients)&&(g.value=S.clients)}catch(a){console.error("Error loading clients:",a),S.clients&&Array.isArray(S.clients)&&(g.value=S.clients)}finally{o.value=!1}}}async function Se(){if(!!E.value)try{const a=await D.post("/api/toggleInternalSales",{client_id:E.value,has_internal_sales:!V.value});V.value=a.data.has_internal_sales,y.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:2e3,position:"bottom-right",rtl:!0}),V.value&&(O(),K())}catch(a){console.error("Error toggling internal sales:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Ue(a=null){if(a&&a.id){const t={id:a.id,car_type:a.car_type,year:a.year,vin:a.vin,car_number:a.car_number,total_s:a.total_s||0,car_price:a.car_price||0};_.value=[t],await oe();const l=me.value.find(b=>b.value===a.id);p.value={client_id:E.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:(l==null?void 0:l.total_s)||a.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:X()},c.value=!1,U.value=!0;return}if(!a&&_.value.length===0&&await K(),await oe(),a&&a.id){const t=_.value.find(l=>l.id===a.id)||a;p.value={client_id:E.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:t.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:X()},c.value=!1,U.value=!0;return}p.value={client_id:E.value,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:X()},c.value=!1,U.value=!0}function be(){U.value=!1,p.value={client_id:null,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:X()},_.value=[],c.value=!1}function je(a){ee.value=a,u.value=!0}function Fe(a){p.value=a,Me()}async function Ie(){var l,b;const a=p.value.client_id&&p.value.client_id!==""&&p.value.client_id!==null&&p.value.client_id!==void 0;if(!c.value&&!a){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(c.value&&!p.value.client_name){y.error("\u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!p.value.car_id){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629",{timeout:2e3,position:"bottom-right",rtl:!0});return}const t={...p.value};c.value?(t.client_id=null,t.client_name=t.client_name||"",t.client_phone=t.client_phone||""):(t.client_id=parseInt(t.client_id)||null,t.client_name=null,t.client_phone=null);try{await D.post("/api/addInternalSale",t),y.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),be(),O(),R(),K()}catch(C){console.error("Error adding internal sale:",C),y.error(((b=(l=C.response)==null?void 0:l.data)==null?void 0:b.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Me(){try{await D.post("/api/updateInternalSale",p.value),y.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),u.value=!1,O(),R()}catch(a){console.error("Error updating internal sale:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Be(a){if(!!confirm("\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629\u061F"))try{await D.post("/api/deleteInternalSale",{id:a.id}),y.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),O(),R(),K()}catch(t){console.error("Error deleting internal sale:",t),y.error("\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Ee(a){const t=M.value.indexOf(a);t>-1?M.value.splice(t,1):M.value.push(a)}function Ne(){M.value.length===k.value.length?M.value=[]:M.value=k.value.map(a=>a.id)}function Te(){if(M.value.length===0){y.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}re.value=!0}function _e(){re.value=!1}async function De(a){var l,b;if(M.value.length===0){y.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!(a.car_price!==null||a.expenses!==null||a.additional_expenses!==null)){y.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0642\u064A\u0645\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const C={sale_ids:M.value,car_price:a.car_price,expenses:a.expenses,additional_expenses:a.additional_expenses};await D.post("/api/bulkUpdateInternalSales",C),y.success(`\u062A\u0645 \u062A\u0639\u062F\u064A\u0644 ${M.value.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),_e(),M.value=[],O(),R()}catch(C){console.error("Error bulk updating internal sales:",C),y.error(((b=(l=C.response)==null?void 0:l.data)==null?void 0:b.error)||"\u0641\u0634\u0644 \u0627\u0644\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u062C\u0645\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Ae(a){if(a.remaining_debt<=0){y.error("\u0644\u0627 \u064A\u0648\u062C\u062F \u062F\u064A\u0646 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646",{timeout:2e3,position:"bottom-right",rtl:!0});return}L.value=a,ue.value=!0}function ve(){ue.value=!1,L.value=null}async function Pe(a){var b,C;if(!L.value)return;const t=typeof a=="object"?a.amount:a,l=typeof a=="object"&&a.note||"";if(!t||t<=0){y.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0635\u062D\u064A\u062D",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(t>L.value.remaining_debt){y.error("\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A",{timeout:2e3,position:"bottom-right",rtl:!0});return}pe.value=!0;try{await D.post("/api/addPaymentToBuyer",{buyer_id:L.value.id,merchant_id:E.value,amount:t,note:l}),y.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),ve(),O(),R()}catch(Q){console.error("Error adding payment:",Q),y.error(((C=(b=Q.response)==null?void 0:b.data)==null?void 0:C.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{pe.value=!1}}function Le(a){L.value=a,ce.value=!0}function Oe(){ce.value=!1,L.value=null}function Ye(){O(),R()}function qe(){_.value.length===0&&K(),oe(),h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:X()},ge.value=!0}function ye(){ge.value=!1,h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:X()}}function He(a){h.value.cars.findIndex(l=>l.car_id===a.id)===-1&&h.value.cars.push({car_id:a.id,car_type:a.car_type,year:a.year,vin:a.vin||a.car_number,total_s:a.total_s||0,sale_price:0,paid_amount:0,expenses:a.total_s||0,additional_expenses:0})}function Re(a){h.value.cars.splice(a,1)}async function ze(){var a,t;if(!h.value.client_id&&!h.value.client_name){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(h.value.cars.length===0){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const l={client_id:h.value.client_id,client_name:h.value.client_name||null,client_phone:h.value.client_phone||null,cars:h.value.cars,sale_date:h.value.sale_date};await D.post("/api/addBulkInternalSale",l),y.success(`\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 ${h.value.cars.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),ye(),O(),R(),K()}catch(l){console.error("Error adding bulk sale:",l),y.error(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}}return Je(()=>{E.value&&(O(),R(),K(),oe())}),(a,t)=>(d(),i(Y,null,[r(s(Ke),{title:"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629"}),r(We,null,{header:N(()=>{var l;return[e("div",At,[e("h2",Pt," \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 - "+n(((l=S.client)==null?void 0:l.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),r(s(Qe),{href:`/showClients/${E.value}`,class:"text-blue-600 hover:text-blue-800 dark:text-blue-400"},{default:N(()=>[...t[21]||(t[21]=[le(" \u0627\u0644\u0639\u0648\u062F\u0629 \u0625\u0644\u0649 \u0635\u0641\u062D\u0629 \u0627\u0644\u062A\u0627\u062C\u0631 ",-1)])]),_:1},8,["href"])])]}),default:N(()=>[e("div",Lt,[e("div",Ot,[e("div",Yt,[t[24]||(t[24]=e("h2",{class:"text-xl font-bold dark:text-gray-400"},"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",qt,[e("label",Ht,[t[23]||(t[23]=e("span",{class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},"\u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Rt,[e("input",{type:"checkbox",class:"sr-only peer",checked:s(V),onChange:Se},null,40,zt),t[22]||(t[22]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])])])]),s(V)&&s(k).length>0?(d(),i("div",Gt,[t[34]||(t[34]=e("h3",{class:"text-lg font-bold mb-4 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Jt,[e("div",Kt,[e("div",Qt,[e("div",null,[t[25]||(t[25]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",-1)),e("p",Wt,n(F(J.value.totalSales))+" $",1)]),t[26]||(t[26]=e("div",{class:"text-blue-500 text-3xl"},"\u{1F4B0}",-1))])]),e("div",Xt,[e("div",Zt,[e("div",null,[t[27]||(t[27]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),e("p",el,n(F(J.value.totalExpenses))+" $",1)]),t[28]||(t[28]=e("div",{class:"text-orange-500 text-3xl"},"\u{1F4CA}",-1))])]),e("div",tl,[e("div",ll,[e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0631\u0628\u062D",-1)),e("p",{class:z(["text-2xl font-bold",J.value.totalProfit>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},n(F(J.value.totalProfit))+" $ ",3)]),t[30]||(t[30]=e("div",{class:"text-green-500 text-3xl"},"\u{1F4C8}",-1))])]),e("div",al,[e("div",sl,[e("div",null,[t[31]||(t[31]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A",-1)),e("p",rl,n(F(J.value.totalDebt))+" $",1)]),t[32]||(t[32]=e("div",{class:"text-red-500 text-3xl"},"\u26A0\uFE0F",-1))])])]),J.value.carTypes.length>0?(d(),i("div",ol,[t[33]||(t[33]=e("h4",{class:"text-md font-bold mb-3 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u0628\u0627\u0639\u0629",-1)),e("div",nl,[(d(!0),i(Y,null,G(J.value.carTypes,l=>(d(),i("div",{key:l.type,class:"bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600"},[e("p",dl,n(l.type),1),e("p",il,n(l.count)+" \u0633\u064A\u0627\u0631\u0629",1)]))),128))])])):B("",!0)])):B("",!0),s(V)&&s(_).length>0?(d(),i("div",ul,[e("div",cl,[e("h3",pl,"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ("+n(s(_).length)+")",1),e("button",{onClick:t[0]||(t[0]=l=>qe()),class:"px-3 py-1 text-sm text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0628\u064A\u0639 \u0645\u062C\u0645\u0639 ")]),s(m)?(d(),i("div",gl,[...t[35]||(t[35]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"},null,-1)])])):s(_).length===0?(d(),i("div",ml," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 \u062D\u0627\u0644\u064A\u0627\u064B ")):(d(),i("div",bl,[e("table",yl,[t[37]||(t[37]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center sticky top-0"},[e("tr",null,[e("th",{class:"px-2 py-3"},"\u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u0646\u0629"),e("th",{class:"px-2 py-3"},"\u0631\u0642\u0645 \u0627\u0644\u0634\u0627\u0635\u064A / \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u062A\u0643\u0644\u0641\u0629 (Total S)"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(d(!0),i(Y,null,G(s(_),l=>(d(),i("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",xl,n(l.car_type),1),e("td",_l,n(l.year),1),e("td",vl,[e("div",fl,n(l.vin),1),l.car_number?(d(),i("div",hl,n(l.car_number),1)):B("",!0)]),e("td",kl,n(F(l.total_s))+" $",1),e("td",wl,[e("button",{onClick:b=>Ue(l),class:"px-3 py-1 text-white bg-blue-600 rounded hover:bg-blue-700 text-xs flex items-center justify-center mx-auto gap-1"},[...t[36]||(t[36]=[e("span",{class:"text-lg"},"+",-1),le(" \u0628\u064A\u0639 ",-1)])],8,$l)])]))),128))])])]))])):B("",!0),s(V)?(d(),i("div",Vl,[s(U)?(d(),i("div",Cl,[e("div",{class:"flex justify-between items-center mb-4"},[t[38]||(t[38]=e("h3",{class:"text-lg font-bold dark:text-gray-100"},"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("button",{onClick:be,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," \u2715 ")]),e("div",Sl,[e("div",null,[e("div",Ul,[r(f,{for:"client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[1]||(t[1]=l=>ke(c)?c.value=!s(c):c=!s(c)),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors duration-200 flex items-center gap-1"},[s(c)?(d(),i("span",Fl,[...t[40]||(t[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),le(" \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F ",-1)])])):(d(),i("span",jl,[...t[39]||(t[39]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),le(" \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F ",-1)])]))])]),s(c)?(d(),i("div",Ml,[e("div",null,[r(f,{for:"client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),r(j,{id:"client_name",modelValue:s(p).client_name,"onUpdate:modelValue":t[3]||(t[3]=l=>s(p).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[r(f,{for:"client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),r(j,{id:"client_phone",modelValue:s(p).client_phone,"onUpdate:modelValue":t[4]||(t[4]=l=>s(p).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(d(),i("div",Il,[r(s(de),{modelValue:s(p).client_id,"onUpdate:modelValue":t[2]||(t[2]=l=>s(p).client_id=l),list:xe.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":s(o),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[r(f,{for:"car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),r(s(de),{modelValue:s(p).car_id,"onUpdate:modelValue":t[5]||(t[5]=l=>s(p).car_id=l),list:me.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0633\u064A\u0627\u0631\u0629 \u0628\u0627\u0644\u0634\u0627\u0646\u0635 (VIN) \u0623\u0648 \u0627\u0644\u0643\u0627\u062A\u064A (\u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629)...","is-disabled":s(m),onChange:Ve,class:"dark:bg-gray-700 dark:text-gray-100"},null,8,["modelValue","list","is-disabled"])]),e("div",null,[q(e("input",{type:"hidden","onUpdate:modelValue":t[6]||(t[6]=l=>s(p).car_price=l)},null,512),[[H,s(p).car_price]])]),q(e("input",{type:"hidden","onUpdate:modelValue":t[7]||(t[7]=l=>s(p).shipping=l)},null,512),[[H,s(p).shipping]]),e("div",null,[r(f,{for:"sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),r(j,{id:"sale_price",type:"number",step:"0.01",modelValue:s(p).sale_price,"onUpdate:modelValue":t[8]||(t[8]=l=>s(p).sale_price=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),r(j,{id:"paid_amount",type:"number",step:"0.01",modelValue:s(p).paid_amount,"onUpdate:modelValue":t[9]||(t[9]=l=>s(p).paid_amount=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),s(p).paid_amount>0?(d(),i("div",Bl,[r(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),q(e("textarea",{id:"payment_note","onUpdate:modelValue":t[10]||(t[10]=l=>s(p).payment_note=l),rows:"2",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 \u0627\u0644\u0623\u0648\u0644\u0649 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[H,s(p).payment_note]])])):B("",!0),q(e("input",{type:"hidden","onUpdate:modelValue":t[11]||(t[11]=l=>s(p).expenses=l)},null,512),[[H,s(p).expenses]]),e("div",null,[r(f,{for:"additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),r(j,{id:"additional_expenses",type:"number",step:"0.01",modelValue:s(p).additional_expenses,"onUpdate:modelValue":t[12]||(t[12]=l=>s(p).additional_expenses=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[r(f,{for:"sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),r(j,{id:"sale_date",type:"date",modelValue:s(p).sale_date,"onUpdate:modelValue":t[13]||(t[13]=l=>s(p).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",El,[r(f,{for:"note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),q(e("textarea",{id:"note","onUpdate:modelValue":t[14]||(t[14]=l=>s(p).note=l),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[H,s(p).note]])])]),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{onClick:be,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:Ie,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800"}," \u0625\u0636\u0627\u0641\u0629 ")])])):B("",!0),t[59]||(t[59]=e("div",{class:"mb-4 flex justify-end"},null,-1)),s(I)?(d(),i("div",Nl,[...t[41]||(t[41]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A...",-1)])])):(d(),i("div",Tl,[s(M).length>0?(d(),i("div",Dl,[e("span",Al," \u062A\u0645 \u0627\u062E\u062A\u064A\u0627\u0631 "+n(s(M).length)+" \u0645\u0628\u064A\u0639\u0629 ",1),e("button",{onClick:Te,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ")])):B("",!0),e("table",Pl,[e("thead",Ll,[e("tr",null,[e("th",Ol,[e("input",{type:"checkbox",checked:s(M).length===s(k).length&&s(k).length>0,onChange:Ne,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,Yl)]),t[42]||(t[42]=e("th",{class:"px-2 py-3"},"#",-1)),t[43]||(t[43]=e("th",{class:"px-2 py-3"},"\u0627\u0633\u0645 \u0627\u0644\u0632\u0628\u0648\u0646 \u0627\u0644\u0645\u0634\u062A\u0631\u064A",-1)),t[44]||(t[44]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[45]||(t[45]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)",-1)),t[46]||(t[46]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[47]||(t[47]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639",-1)),t[48]||(t[48]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639",-1)),t[49]||(t[49]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),t[50]||(t[50]=e("th",{class:"px-2 py-3"},"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629",-1)),t[51]||(t[51]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0631\u0628\u062D",-1)),t[52]||(t[52]=e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639",-1)),t[53]||(t[53]=e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0627\u062A",-1)),t[54]||(t[54]=e("th",{class:"px-2 py-3 print:hidden"},"\u062A\u0646\u0641\u064A\u0630",-1))])]),e("tbody",null,[(d(!0),i(Y,null,G(s(k),(l,b)=>{var C,Q,P,T,te,fe,he;return d(),i("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",ql,[e("input",{type:"checkbox",checked:s(M).includes(l.id),onChange:ne=>Ee(l.id),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,Hl)]),e("td",Rl,n(b+1),1),e("td",zl,[e("div",null,n(((C=l.client)==null?void 0:C.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),(Q=l.client)!=null&&Q.phone?(d(),i("div",Gl,n((P=l.client)==null?void 0:P.phone),1)):B("",!0)]),e("td",Jl,n((T=l.car)==null?void 0:T.car_type)+" "+n((te=l.car)==null?void 0:te.year),1),e("td",Kl,n(((fe=l.car)==null?void 0:fe.vin)||((he=l.car)==null?void 0:he.car_number)||"-"),1),e("td",Ql,n(F(l.car_price))+" $",1),e("td",Wl,n(F(l.sale_price))+" $",1),e("td",Xl,n(F(l.paid_amount))+" $",1),e("td",Zl,n(F(l.expenses))+" $",1),e("td",ea,n(F(l.additional_expenses))+" $",1),e("td",{class:z(["px-2 py-3 font-bold",(parseFloat(l.profit)||0)>=0?"text-green-600":"text-red-600"])},n(F(l.profit))+" $ ",3),e("td",ta,n(Ce(l.sale_date||l.created_at)),1),e("td",la,[l.note?(d(),i("div",aa,n(l.note),1)):B("",!0),l.payment_notes&&l.payment_notes.length>0?(d(),i("div",sa,[(d(!0),i(Y,null,G(l.payment_notes,(ne,Ge)=>(d(),i("div",{key:Ge,class:"mt-1"},[t[55]||(t[55]=e("span",{class:"font-semibold"},"\u062F\u0641\u0639\u0629:",-1)),le(" "+n(ne),1)]))),128))])):B("",!0)]),e("td",ra,[e("button",{onClick:ne=>je(l),class:"px-2 py-1 text-white bg-blue-500 rounded hover:bg-blue-600 mr-1"},[r(Xe,{class:"w-4 h-4 inline"})],8,oa),e("button",{onClick:ne=>Be(l),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600"},[r($e,{class:"w-4 h-4 inline"})],8,na)])])}),128)),s(k).length===0?(d(),i("tr",da,[...t[56]||(t[56]=[e("td",{colspan:"13",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"}," \u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u0628\u064A\u0639\u0627\u062A \u062F\u0627\u062E\u0644\u064A\u0629 ",-1)])])):B("",!0)]),s(k).length>0?(d(),i("tfoot",ia,[e("tr",null,[t[57]||(t[57]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A:",-1)),e("td",ua,n(F(s(k).reduce((l,b)=>l+(parseFloat(b.car_price)||0),0)))+" $",1),e("td",ca,n(F(s(w).total_sales))+" $",1),e("td",pa,n(F(s(w).total_paid))+" $",1),e("td",ga,n(F(s(w).total_expenses))+" $",1),e("td",ma,n(F(s(k).reduce((l,b)=>l+(parseFloat(b.additional_expenses)||0),0)))+" $",1),e("td",{class:z(["px-2 py-3",(parseFloat(s(w).total_profit)||0)>=0?"text-green-600":"text-red-600"])},n(F(s(w).total_profit))+" $ ",3),t[58]||(t[58]=e("td",{colspan:"3"},null,-1))])])):B("",!0)])]))])):B("",!0),s(V)&&s(x).length>0?(d(),i("div",ba,[t[63]||(t[63]=e("h3",{class:"text-lg font-bold mb-4 dark:text-blue-300"},"\u0627\u0644\u0632\u0628\u0627\u0626\u0646 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0648\u0646 \u0641\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),s(A)?(d(),i("div",ya,[...t[60]||(t[60]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(d(),i("div",xa,[(d(!0),i(Y,null,G(s(x),l=>(d(),i("div",{key:l.id,class:z(["p-4 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-md",l.remaining_debt>0?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"])},[e("div",_a,[e("div",null,[e("h4",va,n(l.name),1),e("p",fa,n(l.phone),1)]),e("div",{class:z(["text-center bg-white dark:bg-gray-800 rounded-full px-3 py-1 text-xs font-bold border",l.remaining_debt>0?"text-red-600 border-red-100":"text-green-600 border-green-100"])},n(l.sales_count)+" \u0633\u064A\u0627\u0631\u0629 ",3)]),e("div",ha,[e("div",ka,[t[61]||(t[61]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",wa,n(F(l.total_sales))+" $",1)]),e("div",$a,[t[62]||(t[62]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",Va,n(F(l.total_paid))+" $",1)]),e("div",Ca,[e("span",{class:z(l.remaining_debt>0?"text-red-600":"text-green-600")},n(l.remaining_debt>0?"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):":"\u0648\u0627\u0635\u0644:"),3),e("span",{class:z(l.remaining_debt>0?"text-red-600":"text-green-600")},n(F(Math.abs(l.remaining_debt)))+" $ ",3)])]),e("div",Sa,[e("div",Ua,[l.remaining_debt>0?(d(),i("button",{key:0,onClick:b=>Ae(l),class:"flex-1 px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 font-medium text-sm"}," \u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 ",8,ja)):B("",!0),e("button",{onClick:b=>Le(l),class:"flex-1 px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 font-medium text-sm"}," \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 ",8,Fa)])])],2))),128))]))])):s(V)?B("",!0):(d(),i("div",Ia," \u064A\u062C\u0628 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0623\u0648\u0644\u0627\u064B "))])]),r(et,{show:s(u),sale:s(ee),clients:s(g).map(l=>({value:l.id,text:`${l.name||""}${l.phone?" - "+l.phone:""}`,name:l.name||"",phone:l.phone||""})),onClose:t[15]||(t[15]=l=>ke(u)?u.value=!1:u=!1),onUpdate:Fe},null,8,["show","sale","clients"]),r(Dt,{show:s(re),"selected-count":s(M).length,onClose:_e,onConfirm:De},null,8,["show","selected-count"]),r(_t,{show:s(ue),buyer:s(L),"merchant-id":E.value,"is-loading":s(pe),onClose:ve,onConfirm:Pe},null,8,["show","buyer","merchant-id","is-loading"]),r(Et,{show:s(ce),buyer:s(L),"merchant-id":E.value,onClose:Oe,onRefresh:Ye},null,8,["show","buyer","merchant-id"]),r(se,{show:s(ge),onClose:ye},{header:N(()=>[...t[64]||(t[64]=[e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u0628\u064A\u0639 \u0645\u062C\u0645\u0639 - \u0628\u064A\u0639 \u0639\u062F\u0629 \u0633\u064A\u0627\u0631\u0627\u062A \u0644\u0646\u0641\u0633 \u0627\u0644\u0632\u0628\u0648\u0646",-1)])]),body:N(()=>[e("div",Ma,[e("div",null,[e("div",Ba,[r(f,{for:"bulk_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[16]||(t[16]=l=>s(h).showNewClientForm=!s(h).showNewClientForm),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},[s(h).showNewClientForm?(d(),i("span",Na,"\u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F")):(d(),i("span",Ea,"+ \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F"))])]),s(h).showNewClientForm?(d(),i("div",Da,[e("div",null,[r(f,{for:"bulk_client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),r(j,{id:"bulk_client_name",modelValue:s(h).client_name,"onUpdate:modelValue":t[18]||(t[18]=l=>s(h).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[r(f,{for:"bulk_client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),r(j,{id:"bulk_client_phone",modelValue:s(h).client_phone,"onUpdate:modelValue":t[19]||(t[19]=l=>s(h).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(d(),i("div",Ta,[r(s(de),{modelValue:s(h).client_id,"onUpdate:modelValue":t[17]||(t[17]=l=>s(h).client_id=l),list:xe.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":s(o),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[r(f,{for:"bulk_car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629"}),s(m)?(d(),i("div",Aa,[...t[65]||(t[65]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):s(_).length===0?(d(),i("div",Pa," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ")):(d(),i("div",La,[(d(!0),i(Y,null,G(s(_),l=>(d(),i("div",{key:l.id,class:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded mb-1"},[e("div",Oa,[e("span",Ya,n(l.car_type)+" "+n(l.year),1),e("span",qa,"- "+n(l.vin||l.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"),1),e("span",Ha,"("+n(F(l.total_s))+" $)",1)]),e("button",{onClick:b=>He(l),disabled:s(h).cars.some(b=>b.car_id===l.id),class:"px-3 py-1 text-xs text-white bg-green-600 rounded hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},n(s(h).cars.some(b=>b.car_id===l.id)?"\u0645\u0636\u0627\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629"),9,Ra)]))),128))]))]),s(h).cars.length>0?(d(),i("div",za,[r(f,{value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629"}),e("div",Ga,[(d(!0),i(Y,null,G(s(h).cars,(l,b)=>(d(),i("div",{key:b,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700"},[e("div",Ja,[e("div",null,[e("p",Ka,n(l.car_type)+" "+n(l.year),1),e("p",Qa,n(l.vin),1)]),e("button",{onClick:C=>Re(b),class:"text-red-600 hover:text-red-800 text-sm"}," \u2715 \u062D\u0630\u0641 ",8,Wa)]),e("div",Xa,[e("div",null,[r(f,{for:`sale_price_${b}`,value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)",class:"text-xs"},null,8,["for"]),r(j,{id:`sale_price_${b}`,type:"number",step:"0.01",modelValue:l.sale_price,"onUpdate:modelValue":C=>l.sale_price=C,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])]),e("div",null,[r(f,{for:`paid_amount_${b}`,value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)",class:"text-xs"},null,8,["for"]),r(j,{id:`paid_amount_${b}`,type:"number",step:"0.01",modelValue:l.paid_amount,"onUpdate:modelValue":C=>l.paid_amount=C,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])])])]))),128))])])):B("",!0),e("div",null,[r(f,{for:"bulk_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),r(j,{id:"bulk_sale_date",type:"date",modelValue:s(h).sale_date,"onUpdate:modelValue":t[20]||(t[20]=l=>s(h).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:N(()=>[e("div",Za,[e("button",{onClick:ye,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:ze,class:"px-4 py-2 text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A ("+n(s(h).cars.length)+") ",1)])]),_:1},8,["show"])]),_:1})],64))}};export{cs as default};
