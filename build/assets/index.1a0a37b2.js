import{z as H,x as z,r as i,a as w,g as d,j as a,k as v,w as x,F as N,o as k,H as O,b as e,e as W,v as Y,L as G,f as J,h as K,t as f,i as Q}from"./app.6f997750.js";import{_ as X}from"./AuthenticatedLayout.7eeaec6c.js";import{_ as E}from"./TextInput.5fa7f9fd.js";import{p as Z}from"./print.e6b23823.js";import{e as ee}from"./edit.8da7742b.js";import{t as te}from"./trash.9f1173c0.js";import{_ as oe}from"./ModalShowDamageReport.f768a56e.js";import{M as se}from"./ModalDelCar.cb4990f7.js";import{W as ae}from"./v3-infinite-loading.es.06d8e97b.js";import{d as re}from"./debounce.0eaa7744.js";import{a as M}from"./index.eadb1587.js";/* empty css                                                    */const le={class:"py-2"},ne={class:"max-w-9xl mx-auto sm:px-6 lg:px-8"},de={class:"bg-white overflow-hidden shadow-sm"},ie={class:"p-6 dark:bg-gray-900"},pe={class:"flex flex-col"},me={class:"grid grid-cols-2 md:grid-cols-5 lg:grid-cols-5 gap-2 lg:gap-1"},ue={class:"flex items-center max-w-5xl mt-1"},ce={class:"relative w-full"},ge={class:"py-2"},xe={class:"max-w-9xl mx-auto sm:px-6 lg:px-8"},fe={class:"bg-white overflow-hidden shadow-sm"},ye={class:"p-6 dark:bg-gray-900"},be={class:"overflow-x-auto"},ve={class:"w-full text-sm text-left text-gray-500 dark:text-gray-400"},he={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},_e={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},we={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},ke={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},De={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Re={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Ce={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Ie=["onClick"],Ve=["onClick"],$e=["onClick"],He={__name:"index",props:{owner_id:Number},setup(Me){H();const y=z();let p=i(!1),m=i(!1),D=i({driver_name:"",cmr_number:"",cars_count:0,total_damage:0,cars_info:[],created:V()}),T=i({}),h=i([]),u=i(""),c=i(""),g=i(""),R=i(!1),C=1,A=i(0);const I=()=>{C=1,h.value=[],R.value=!R.value},P=async o=>{var t,s,n,b;try{const r={limit:100,page:C};g.value&&(r.q=g.value),u.value&&(r.from=u.value),c.value&&(r.to=c.value),console.log("Request params:",r);const $=await M.get("/api/getIndexDamageReport",{params:r});console.log("API Response:",$.data),console.log("Response status:",$.status);const l=$.data;if(l.error){console.error("API Error:",l.error),y.error("\u062D\u062F\u062B \u062E\u0637\u0623: "+l.error,{timeout:3e3,position:"bottom-right",rtl:!0}),o.complete();return}A.value=l.total||0,console.log("Total reports:",A.value),console.log("Data array length:",((t=l.data)==null?void 0:t.length)||0),l.data&&Array.isArray(l.data)&&l.data.length>0?(console.log("Adding reports:",l.data.length),l.data.length<100?(h.value.push(...l.data),o.complete()):(h.value.push(...l.data),o.loaded()),C++):(console.log("No data found in response"),console.log("Response structure:",Object.keys(l)),o.complete())}catch(r){console.error("Error fetching reports:",r),console.error("Error response:",(s=r.response)==null?void 0:s.data),y.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062C\u0644\u0628 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A: "+(((b=(n=r.response)==null?void 0:n.data)==null?void 0:b.error)||r.message),{timeout:3e3,position:"bottom-right",rtl:!0}),o.complete()}};function V(){const o=new Date,t=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${t}-${s}-${n}`}function S(o){return o?o.includes("T")?o.split("T")[0]:o:""}function j(o=null){o?D.value={id:o.id,driver_name:o.driver_name||"",cmr_number:o.cmr_number||"",cars_count:o.cars_count||0,total_damage:o.total_damage||0,cars_info:o.cars_info||[],created:o.created||V()}:D.value={driver_name:"",cmr_number:"",cars_count:0,total_damage:0,cars_info:[],created:V()},p.value=!0}function q(o){const t=o.id?"/api/updateDamageReport":"/api/storeDamageReport",s=(o.id,"post");M[s](t,o).then(n=>{var r;p.value=!1,y.success(o.id?"\u062A\u0645 \u0627\u0644\u062A\u0639\u062F\u064A\u0644 \u0628\u0646\u062C\u0627\u062D":"\u062A\u0645 \u0627\u0644\u062D\u0641\u0638 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0});const b=n.data.id||((r=n.data.data)==null?void 0:r.id);b&&setTimeout(()=>{window.open(`/api/makeDamageReportPdf?doc_id=${b}`,"_blank")},500),I()}).catch(n=>{p.value=!1,y.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u062D\u0641\u0638",{timeout:2e3,position:"bottom-right",rtl:!0})})}function B(o){T.value=o,m.value=!0}function F(o){M.post("/api/deleteDamageReport",o).then(t=>{m.value=!1,y.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062A\u0642\u0631\u064A\u0631 \u0628\u0646\u062C\u0627\u062D",{timeout:3e3,position:"bottom-right",rtl:!0}),I()}).catch(t=>{console.error(t)})}function L(o){window.open(`/api/makeDamageReportPdf?doc_id=${o.id}`,"_blank")}function U(o){window.location=`/damage_report/${o.id}/edit`}const _=re(I,500);return(o,t)=>(k(),w(N,null,[d(a(O),{title:"\u062A\u0642\u0627\u0631\u064A\u0631 \u0627\u0644\u0636\u0631\u0631"}),d(oe,{show:a(p),formDamage:a(D),onSave:t[0]||(t[0]=s=>q(s)),onClose:t[1]||(t[1]=s=>v(p)?p.value=!1:p=!1)},null,8,["show","formDamage"]),d(se,{show:a(m),formData:a(T),onA:t[2]||(t[2]=s=>F(s)),onClose:t[3]||(t[3]=s=>v(m)?m.value=!1:m=!1)},{header:x(()=>[...t[9]||(t[9]=[e("h2",{class:"my-5 dark:text-white text-center"},"\u0647\u0644 \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0627\u0644\u062A\u0642\u0631\u064A\u0631\u061F",-1)])]),_:1},8,["show","formData"]),d(X,null,{default:x(()=>[e("div",le,[e("div",ne,[e("div",de,[e("div",ie,[e("div",pe,[e("div",me,[e("div",null,[e("form",ue,[e("div",ce,[W(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>v(g)?g.value=s:g=s),onInput:t[5]||(t[5]=(...s)=>a(_)&&a(_)(...s)),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"\u0628\u062D\u062B..."},null,544),[[Y,a(g)]])])])]),e("div",null,[t[10]||(t[10]=e("label",{class:"dark:text-gray-200 text-sm"},"\u0645\u0646 \u062A\u0627\u0631\u064A\u062E",-1)),d(E,{type:"date",modelValue:a(u),"onUpdate:modelValue":t[6]||(t[6]=s=>v(u)?u.value=s:u=s),onInput:a(_),class:"mt-1 block w-full"},null,8,["modelValue","onInput"])]),e("div",null,[t[11]||(t[11]=e("label",{class:"dark:text-gray-200 text-sm"},"\u0625\u0644\u0649 \u062A\u0627\u0631\u064A\u062E",-1)),d(E,{type:"date",modelValue:a(c),"onUpdate:modelValue":t[7]||(t[7]=s=>v(c)?c.value=s:c=s),onInput:a(_),class:"mt-1 block w-full"},null,8,["modelValue","onInput"])]),e("div",null,[e("button",{onClick:t[8]||(t[8]=s=>j()),class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," \u062A\u0642\u0631\u064A\u0631 \u062C\u062F\u064A\u062F ")]),e("div",null,[d(a(G),{href:o.route("dashboard"),class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"},{default:x(()=>[...t[12]||(t[12]=[J(" \u0627\u0644\u0639\u0648\u062F\u0629 ",-1)])]),_:1},8,["href"])])])])])])])]),e("div",ge,[e("div",xe,[e("div",fe,[e("div",ye,[e("div",be,[e("table",ve,[t[13]||(t[13]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0631\u0642\u0645"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0627\u0644\u062A\u0627\u0631\u064A\u062E"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0627\u0633\u0645 \u0627\u0644\u0633\u0627\u0626\u0642"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0631\u0642\u0645 CMR"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0639\u062F\u062F \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0636\u0631\u0631"),e("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2",style:{width:"240px"}},"\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A")])],-1)),e("tbody",null,[(k(!0),w(N,null,K(a(h),s=>(k(),w("tr",{key:s.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-900 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",he,f(s.id),1),e("td",_e,f(S(s.created)),1),e("td",we,f(s.driver_name),1),e("td",ke,f(s.cmr_number),1),e("td",De,f(s.cars_count),1),e("td",Re,f(s.total_damage)+"$",1),e("td",Ce,[e("button",{onClick:n=>L(s),class:"px-2 py-1 mx-1 bg-blue-500 text-white rounded hover:bg-blue-600",title:"\u0637\u0628\u0627\u0639\u0629"},[d(Z,{class:"w-4 h-4"})],8,Ie),o.$page.props.auth.user.type_id==1?(k(),w("button",{key:0,onClick:n=>U(s),class:"px-2 py-1 mx-1 bg-green-500 text-white rounded hover:bg-green-600",title:"\u062A\u0639\u062F\u064A\u0644"},[d(ee,{class:"w-4 h-4"})],8,Ve)):Q("",!0),e("button",{onClick:n=>B(s),class:"px-2 py-1 mx-1 bg-red-500 text-white rounded hover:bg-red-600",title:"\u062D\u0630\u0641"},[d(te,{class:"w-4 h-4"})],8,$e)])]))),128))])]),d(a(ae),{onInfinite:P,reset:a(R)},{spinner:x(()=>[...t[14]||(t[14]=[e("div",{class:"text-center py-4"},"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...",-1)])]),complete:x(()=>[...t[15]||(t[15]=[e("div",{class:"text-center py-4"},"\u062A\u0645 \u062A\u062D\u0645\u064A\u0644 \u062C\u0645\u064A\u0639 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A",-1)])]),error:x(()=>[...t[16]||(t[16]=[e("div",{class:"text-center py-4 text-red-500"},"\u062D\u062F\u062B \u062E\u0637\u0623",-1)])]),_:1},8,["reset"])])])])])])]),_:1})],64))}};export{He as default};
