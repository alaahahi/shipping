import{r as v,l as ue,o as s,c as be,w as L,b as e,g as n,q as r,e as G,v as J,m as Z,t as o,a as d,i as j,n as W,u as je,F as z,h as X,j as Ze,H as et,L as tt,f as ie,s as oe}from"./app.007d40d0.js";import{_ as lt}from"./AuthenticatedLayout.75c2b4b6.js";import{M as ce}from"./Modal.be7047b7.js";import{_ as f}from"./InputLabel.0071bc6e.js";import{_ as U}from"./TextInput.1a581886.js";import{q as ye}from"./VueSearchSelect.2174dcac.js";/* empty css                        */import{a as q}from"./index.482155e4.js";import{t as Fe}from"./trash.62f7e4ab.js";import{e as at}from"./edit.a18d86e9.js";import"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                              */const rt={class:"space-y-4"},st={__name:"ModalEditInternalSale",props:{show:Boolean,sale:Object,clients:Array},emits:["close","update"],setup(V,{emit:b}){const C=V,I=b,u=v({id:null,client_id:null,client_name:"",client_phone:"",car_id:null,car_name:"",car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",sale_date:""}),w=v(!1);function $(){const y=new Date,m=y.getFullYear(),i=String(y.getMonth()+1).padStart(2,"0"),c=String(y.getDate()).padStart(2,"0");return`${m}-${i}-${c}`}function S(y){if(!y)return $();try{if(typeof y=="string"&&y.includes("T"))return y.split("T")[0];const m=new Date(y);if(isNaN(m.getTime()))return y;const i=m.getFullYear(),c=String(m.getMonth()+1).padStart(2,"0"),_=String(m.getDate()).padStart(2,"0");return`${i}-${c}-${_}`}catch{return y}}ue(()=>C.sale,y=>{y&&(u.value={id:y.id,client_id:y.client_id,car_id:y.car_id,car_name:y.car?`${y.car.car_type} ${y.car.year} - ${y.car.vin||y.car.car_number}`:"",car_price:y.car_price||0,shipping:y.shipping||0,sale_price:y.sale_price,paid_amount:y.paid_amount,expenses:y.expenses,additional_expenses:y.additional_expenses||0,note:y.note||"",sale_date:S(y.sale_date||y.created_at),client_name:"",client_phone:""},w.value=!1)},{deep:!0,immediate:!0});function N(){I("update",u.value)}function x(){I("close")}return(y,m)=>(s(),be(ce,{show:V.show,onClose:x},{header:L(()=>[m[11]||(m[11]=e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u062A\u0639\u062F\u064A\u0644 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",rt,[e("div",null,[n(f,{for:"edit_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644"}),n(r(ye),{modelValue:u.value.client_id,"onUpdate:modelValue":m[0]||(m[0]=i=>u.value.client_id=i),list:V.clients,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644...",class:"dark:bg-gray-800 dark:text-gray-100"},null,8,["modelValue","list"])]),e("div",null,[n(f,{for:"car_display_edit",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),n(U,{id:"car_display_edit",type:"text",modelValue:u.value.car_name,"onUpdate:modelValue":m[1]||(m[1]=i=>u.value.car_name=i),class:"mt-1 block w-full bg-gray-100 dark:bg-gray-800 cursor-not-allowed text-gray-500 dark:text-gray-400",disabled:""},null,8,["modelValue"])]),e("div",null,[G(e("input",{type:"hidden","onUpdate:modelValue":m[2]||(m[2]=i=>u.value.car_id=i)},null,512),[[J,u.value.car_id]])]),e("div",null,[n(f,{for:"edit_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),n(U,{id:"edit_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":m[3]||(m[3]=i=>u.value.car_price=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[G(e("input",{type:"hidden","onUpdate:modelValue":m[4]||(m[4]=i=>u.value.shipping=i)},null,512),[[J,u.value.shipping]])]),e("div",null,[n(f,{for:"edit_sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),n(U,{id:"edit_sale_price",type:"number",step:"0.01",modelValue:u.value.sale_price,"onUpdate:modelValue":m[5]||(m[5]=i=>u.value.sale_price=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"edit_paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),n(U,{id:"edit_paid_amount",type:"number",step:"0.01",modelValue:u.value.paid_amount,"onUpdate:modelValue":m[6]||(m[6]=i=>u.value.paid_amount=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"edit_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),n(U,{id:"edit_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":m[7]||(m[7]=i=>u.value.expenses=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"edit_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),n(U,{id:"edit_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":m[8]||(m[8]=i=>u.value.additional_expenses=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"edit_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),n(U,{id:"edit_sale_date",type:"date",modelValue:u.value.sale_date,"onUpdate:modelValue":m[9]||(m[9]=i=>u.value.sale_date=i),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"edit_note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),G(e("textarea",{id:"edit_note","onUpdate:modelValue":m[10]||(m[10]=i=>u.value.note=i),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"},null,512),[[J,u.value.note]])])])]),footer:L(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:x,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:N,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u062D\u062F\u064A\u062B ")])]),_:1},8,["show"]))}},ot={class:"text-xl font-bold dark:text-gray-100"},nt={key:0,class:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},dt={class:"text-sm space-y-1"},it={class:"flex justify-between"},ut={class:"font-medium"},ct={class:"flex justify-between"},pt={class:"font-medium text-green-600"},gt={class:"flex justify-between font-bold text-lg pt-2 border-t"},mt={class:"text-red-600"},yt={class:"space-y-4"},bt={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},xt={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},_t={class:"flex justify-end gap-2"},vt=["disabled"],ft=["disabled"],ht={key:0},kt={key:1},wt={__name:"ModalAddPayment",props:{show:Boolean,buyer:Object,merchantId:[String,Number],isLoading:Boolean},emits:["close","confirm"],setup(V,{emit:b}){const C=V,I=b,u=v(0),w=v(""),$=v(""),S=Z(()=>!C.buyer||!C.buyer.remaining_debt?0:Math.abs(C.buyer.remaining_debt)),N=Z(()=>{const i=parseFloat(u.value)||0;return i<=0?($.value="\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0635\u0641\u0631",!1):i>S.value?($.value=`\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A (${x(S.value)} $)`,!1):($.value="",!0)});ue(()=>C.show,i=>{i&&(u.value=0,w.value="",$.value="")}),ue(u,()=>{u.value?N.value:$.value=""});function x(i){return i==null?"0":(typeof i=="number"?i:parseFloat(i)||0).toFixed(2).replace(/\.00$/,"")}function y(){I("close")}function m(){!N.value||I("confirm",{amount:parseFloat(u.value)||0,note:w.value||""})}return(i,c)=>(s(),be(ce,{show:V.show,onClose:y},{header:L(()=>{var _;return[e("h2",ot,"\u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 - "+o((_=V.buyer)==null?void 0:_.name),1)]}),body:L(()=>[V.buyer?(s(),d("div",nt,[e("div",dt,[e("div",it,[c[2]||(c[2]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",ut,o(x(V.buyer.total_sales))+" $",1)]),e("div",ct,[c[3]||(c[3]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",pt,o(x(V.buyer.total_paid))+" $",1)]),e("div",gt,[c[4]||(c[4]=e("span",{class:"text-red-600"},"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):",-1)),e("span",mt,o(x(Math.abs(V.buyer.remaining_debt)))+" $",1)])])])):j("",!0),e("div",yt,[e("div",null,[n(f,{for:"payment_amount",value:"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639 ($)"}),n(U,{id:"payment_amount",type:"number",step:"0.01",min:"0",modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=_=>u.value=_),max:S.value,placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639",class:W(["mt-1 block w-full",$.value?"border-red-500 focus:border-red-500 focus:ring-red-500":""])},null,8,["modelValue","max","class"]),$.value?(s(),d("p",bt,o($.value),1)):(s(),d("p",xt," \u0627\u0644\u062D\u062F \u0627\u0644\u0623\u0642\u0635\u0649: "+o(x(S.value))+" $ ",1))]),e("div",null,[n(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),G(e("textarea",{id:"payment_note","onUpdate:modelValue":c[1]||(c[1]=_=>w.value=_),rows:"3",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[J,w.value]])])])]),footer:L(()=>[e("div",_t,[e("button",{onClick:y,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",disabled:V.isLoading}," \u0625\u0644\u063A\u0627\u0621 ",8,vt),e("button",{onClick:m,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V.isLoading||!N.value||!u.value||u.value<=0},[V.isLoading?(s(),d("span",ht,"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...")):(s(),d("span",kt,"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639"))],8,ft)])]),_:1},8,["show"]))}},$t={class:"text-xl font-bold dark:text-gray-100"},Vt={key:0,class:"text-center py-4"},Ct={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},St={key:2,class:"overflow-x-auto"},Ut={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},It={class:"px-2 py-3"},jt={class:"px-2 py-3"},Ft={class:"px-2 py-3 font-mono text-xs"},Mt={class:"px-2 py-3 text-green-600 font-bold"},Nt={class:"px-2 py-3"},Bt={class:"px-2 py-3 text-sm"},Tt={class:"px-2 py-3"},Et=["onClick"],Lt={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},Pt={class:"px-2 py-3 text-green-600"},Dt={__name:"ModalPaymentDetails",props:{show:Boolean,buyer:Object,merchantId:[String,Number]},emits:["close","refresh"],setup(V,{emit:b}){const C=je(),I=V,u=b,w=v([]),$=v(!1);ue(()=>I.show,i=>{i&&I.buyer&&I.merchantId?x():w.value=[]});function S(i){return i==null?"0":(typeof i=="number"?i:parseFloat(i)||0).toFixed(2).replace(/\.00$/,"")}function N(i){if(!i)return"-";try{if(typeof i=="string"&&i.includes("T"))return i.split("T")[0];const c=new Date(i);if(isNaN(c.getTime()))return i;const _=c.getFullYear(),O=String(c.getMonth()+1).padStart(2,"0"),ae=String(c.getDate()).padStart(2,"0");return`${_}-${O}-${ae}`}catch{return i}}async function x(){if(!(!I.buyer||!I.merchantId)){$.value=!0;try{const i=await q.get("/api/getBuyerPaymentDetails",{params:{buyer_id:I.buyer.id,merchant_id:I.merchantId}});w.value=i.data.payments||[]}catch(i){console.error("Error loading payment details:",i),w.value=[],C.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{$.value=!1}}}async function y(i){var c,_;if(!!confirm(`\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0642\u064A\u0645\u0629 ${S(i.amount)} $\u061F`))try{await q.post("/api/deletePayment",{sale_id:i.sale_id,payment_id:i.id}),C.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),await x(),u("refresh")}catch(O){console.error("Error deleting payment:",O),C.error(((_=(c=O.response)==null?void 0:c.data)==null?void 0:_.error)||"\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function m(){u("close")}return(i,c)=>(s(),be(ce,{show:V.show,onClose:m},{header:L(()=>{var _;return[e("h2",$t,"\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 - "+o((_=V.buyer)==null?void 0:_.name),1)]}),body:L(()=>[$.value?(s(),d("div",Vt,[...c[0]||(c[0]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):w.value.length===0?(s(),d("div",Ct," \u0644\u0627 \u062A\u0648\u062C\u062F \u062F\u0641\u0639\u0627\u062A \u0645\u0633\u062C\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646 ")):(s(),d("div",St,[e("table",Ut,[c[3]||(c[3]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},[e("tr",null,[e("th",{class:"px-2 py-3"},"#"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A"),e("th",{class:"px-2 py-3"},"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0629"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(s(!0),d(z,null,X(w.value,(_,O)=>{var ae,p,ne,F;return s(),d("tr",{key:_.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",It,o(O+1),1),e("td",jt,o((ae=_.car)==null?void 0:ae.car_type)+" "+o((p=_.car)==null?void 0:p.year),1),e("td",Ft,o(((ne=_.car)==null?void 0:ne.vin)||((F=_.car)==null?void 0:F.car_number)||"-"),1),e("td",Mt,o(S(_.amount))+" $",1),e("td",Nt,o(N(_.date)),1),e("td",Bt,o(_.note||"-"),1),e("td",Tt,[e("button",{onClick:pe=>y(_),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600",title:"\u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629"},[n(Fe,{class:"w-4 h-4 inline"})],8,Et)])])}),128))]),w.value.length>0?(s(),d("tfoot",Lt,[e("tr",null,[c[1]||(c[1]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u062F\u0641\u0639\u0627\u062A:",-1)),e("td",Pt,o(S(w.value.reduce((_,O)=>_+(parseFloat(O.amount)||0),0)))+" $ ",1),c[2]||(c[2]=e("td",{colspan:"3"},null,-1))])])):j("",!0)])]))]),footer:L(()=>[e("div",{class:"flex justify-end"},[e("button",{onClick:m,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u063A\u0644\u0627\u0642 ")])]),_:1},8,["show"]))}},At={class:"text-xl font-bold dark:text-gray-100"},qt={class:"space-y-4"},Ot={__name:"ModalBulkEditInternalSales",props:{show:Boolean,selectedCount:Number},emits:["close","confirm"],setup(V,{emit:b}){const C=V,I=b,u=v({car_price:null,expenses:null,additional_expenses:null});ue(()=>C.show,S=>{S&&(u.value={car_price:null,expenses:null,additional_expenses:null})});function w(){I("close")}function $(){I("confirm",{car_price:u.value.car_price!==null?parseFloat(u.value.car_price):null,expenses:u.value.expenses!==null?parseFloat(u.value.expenses):null,additional_expenses:u.value.additional_expenses!==null?parseFloat(u.value.additional_expenses):null})}return(S,N)=>(s(),be(ce,{show:V.show,onClose:w},{header:L(()=>[e("h2",At,"\u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ("+o(V.selectedCount)+" \u0645\u0628\u064A\u0639\u0629)",1)]),body:L(()=>[N[3]||(N[3]=e("div",{class:"mb-4 text-sm text-gray-600 dark:text-gray-400"}," \u0633\u064A\u062A\u0645 \u062A\u0637\u0628\u064A\u0642 \u0627\u0644\u0642\u064A\u0645 \u0627\u0644\u0645\u062F\u062E\u0644\u0629 \u0639\u0644\u0649 \u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629. \u0627\u062A\u0631\u0643 \u0627\u0644\u062D\u0642\u0644 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647. ",-1)),e("div",qt,[e("div",null,[n(f,{for:"bulk_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),n(U,{id:"bulk_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":N[0]||(N[0]=x=>u.value.car_price=x),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"bulk_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),n(U,{id:"bulk_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":N[1]||(N[1]=x=>u.value.expenses=x),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"bulk_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),n(U,{id:"bulk_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":N[2]||(N[2]=x=>u.value.additional_expenses=x),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:L(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:w,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:$,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062D\u0641\u0638 \u0627\u0644\u062A\u0639\u062F\u064A\u0644\u0627\u062A ")])]),_:1},8,["show"]))}},Yt={class:"flex justify-between items-center"},Rt={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},Ht={class:"max-w-9xl mx-auto sm:px-6 lg:px-8 p-6 dark:bg-gray-900"},zt={class:"overflow-hidden shadow-sm sm:rounded-lg"},Gt={class:"mb-4 flex items-center justify-between"},Jt={class:"flex items-center gap-4"},Kt={class:"flex items-center cursor-pointer"},Qt={class:"relative"},Wt=["checked"],Xt={key:0,class:"mb-6"},Zt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"},el={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},tl={class:"flex items-center justify-between"},ll={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},al={class:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4"},rl={class:"flex items-center justify-between"},sl={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},ol={class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},nl={class:"flex items-center justify-between"},dl={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},il={class:"flex items-center justify-between"},ul={class:"text-2xl font-bold text-red-600 dark:text-red-400"},cl={key:0,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700"},pl={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},gl={class:"text-sm text-gray-600 dark:text-gray-400"},ml={class:"text-lg font-bold text-gray-800 dark:text-gray-200"},yl={key:1,class:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800"},bl={class:"flex justify-between items-center mb-4"},xl={class:"text-lg font-bold dark:text-green-300"},_l={class:"mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},vl={class:"flex items-center gap-2"},fl={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},hl={key:0,class:"text-center py-4"},kl={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},wl={key:2,class:"text-center py-4 text-gray-500 dark:text-gray-400"},$l={key:0},Vl={key:1},Cl={key:3,class:"overflow-x-auto max-h-96 overflow-y-auto"},Sl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},Ul={class:"px-2 py-3 font-medium"},Il={class:"px-2 py-3"},jl={class:"px-2 py-3"},Fl={class:"font-mono text-xs"},Ml={key:0,class:"text-xs text-gray-500"},Nl={class:"px-2 py-3 font-bold"},Bl={class:"px-2 py-3"},Tl=["onClick"],El={key:2,class:"mt-4"},Ll={key:0,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Pl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dl={class:"flex justify-between items-center mb-2"},Al={key:0},ql={key:1},Ol={key:0,class:"relative"},Yl={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},Rl={key:0},Hl={class:"md:col-span-2"},zl={key:1,class:"text-center py-10"},Gl={key:2,class:"overflow-x-auto shadow-md sm:rounded-lg"},Jl={class:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Kl={class:"flex items-center gap-2"},Ql={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Wl={key:0,class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 flex justify-between items-center"},Xl={class:"text-blue-700 dark:text-blue-300 font-medium"},Zl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},ea={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},ta={class:"px-2 py-3 print:hidden"},la=["checked"],aa={class:"px-2 py-3 print:hidden"},ra=["checked","onChange"],sa={class:"px-2 py-3"},oa={class:"px-2 py-3 font-medium"},na={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},da={class:"px-2 py-3"},ia={class:"px-2 py-3 font-mono text-xs"},ua={class:"px-2 py-3"},ca={class:"px-2 py-3"},pa={class:"px-2 py-3"},ga={class:"px-2 py-3"},ma={class:"px-2 py-3"},ya={class:"px-2 py-3"},ba={class:"px-2 py-3"},xa={key:0,class:"mb-1"},_a={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},va={class:"px-2 py-3 print:hidden"},fa=["onClick"],ha=["onClick"],ka={key:0,class:"bg-gray-100 dark:bg-gray-800"},wa={colspan:"13",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},$a={key:0},Va={key:1},Ca={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},Sa={class:"px-2 py-3"},Ua={class:"px-2 py-3"},Ia={class:"px-2 py-3"},ja={class:"px-2 py-3"},Fa={class:"px-2 py-3"},Ma={key:3,class:"mb-6 mt-6"},Na={key:0,class:"text-center py-4"},Ba={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ta={class:"flex justify-between items-start mb-3"},Ea={class:"font-bold text-lg text-gray-800 dark:text-gray-200"},La={class:"text-sm text-gray-500 dark:text-gray-400"},Pa={class:"space-y-2 text-sm"},Da={class:"flex justify-between"},Aa={class:"font-medium"},qa={class:"flex justify-between"},Oa={class:"font-medium text-green-600"},Ya={class:"border-t pt-2 mt-2 flex justify-between items-center font-bold text-lg"},Ra={class:"mt-3 pt-3 border-t"},Ha={class:"flex gap-2"},za=["onClick"],Ga=["onClick"],Ja={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ka={class:"space-y-4"},Qa={class:"flex justify-between items-center mb-2"},Wa={key:0},Xa={key:1},Za={key:0,class:"relative"},er={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},tr={key:0,class:"text-center py-4"},lr={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},ar={key:2,class:"max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-2"},rr={class:"flex-1"},sr={class:"font-medium"},or={class:"text-xs text-gray-500 dark:text-gray-400 mr-2"},nr={class:"text-xs text-blue-600 dark:text-blue-400"},dr=["onClick","disabled"],ir={key:0},ur={class:"space-y-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3"},cr={class:"flex justify-between items-start mb-2"},pr={class:"font-medium"},gr={class:"text-xs text-gray-500 dark:text-gray-400"},mr=["onClick"],yr={class:"grid grid-cols-2 gap-2 mt-2"},br={class:"flex justify-end gap-2"},Ir={__name:"InternalSales",props:{url:String,client_id:String,client:Object,clients:Array},setup(V){let b=je();const C=V;let I=v(!1),u=v(!1),w=v([]),$=v({}),S=v(!1),N=v(!1),x=v([]),y=v(!1),m=v([]),i=v(!1),c=v(!1),_=v([]),O=v(!1),ae=v(null),p=v({}),ne=v(null),F=v([]),pe=v(!1),xe=v(!1),_e=v(!1),R=v(null),ve=v(!1),fe=v(!1),h=v({client_id:null,client_name:"",client_phone:"",cars:[],sale_date:"",showNewClientForm:!1}),D=v(""),A=v("");const B=Z(()=>{var a;return C.client_id||((a=C.client)==null?void 0:a.id)}),ee=Z(()=>{const a=w.value,t={};a.forEach(P=>{var E;const T=((E=P.car)==null?void 0:E.car_type)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F";t[T]||(t[T]=0),t[T]++});const l=_.value.reduce((P,T)=>P+(T.remaining_debt>0?T.remaining_debt:0),0),g=$.value.total_sales||0,k=($.value.total_expenses||0)+a.reduce((P,T)=>P+(parseFloat(T.additional_expenses)||0),0),Y=$.value.total_profit||0;return{carTypes:Object.entries(t).map(([P,T])=>({type:P,count:T})),totalDebt:l,totalSales:g,totalExpenses:k,totalProfit:Y,totalCarsSold:a.length}}),he=Z(()=>x.value.length>0?x.value.map(a=>({value:a.id,text:`${a.car_type||""} ${a.year||""} - ${a.vin||a.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"}`,vin:a.vin||"",car_number:a.car_number||"",car_type:a.car_type||"",year:a.year||"",total_s:a.total_s||0,car_price:a.car_price||0})):[]),Ve=Z(()=>m.value.length>0?m.value.map(a=>({value:a.id,text:`${a.name||""}${a.phone?" - "+a.phone:""}`,name:a.name||"",phone:a.phone||""})):[]),re=Z(()=>{if(!D.value||D.value.trim()==="")return w.value;const a=D.value.toLowerCase().trim();return w.value.filter(t=>{var E,te,de,le,me,Ie;const l=(((E=t.car)==null?void 0:E.vin)||"").toLowerCase(),g=String(((te=t.car)==null?void 0:te.car_number)||"").toLowerCase(),k=(((de=t.car)==null?void 0:de.car_type)||"").toLowerCase(),Y=(((le=t.car)==null?void 0:le.year)||"").toString().toLowerCase(),P=(((me=t.client)==null?void 0:me.name)||"").toLowerCase(),T=(((Ie=t.client)==null?void 0:Ie.phone)||"").toLowerCase();return l.includes(a)||g.includes(a)||k.includes(a)||Y.includes(a)||P.includes(a)||T.includes(a)})}),ke=Z(()=>{if(!A.value||A.value.trim()==="")return x.value;const a=A.value.toLowerCase().trim();return x.value.filter(t=>{const l=(t.vin||"").toLowerCase(),g=String(t.car_number||"").toLowerCase(),k=(t.car_type||"").toLowerCase(),Y=(t.year||"").toString().toLowerCase();return l.includes(a)||g.includes(a)||k.includes(a)||Y.includes(a)})});function Me(){const a=he.value.find(t=>t.value===p.value.car_id);if(a){p.value.car_price=0;const t=a.total_s;p.value.shipping=0;let l=t;if(!t||t===0){const g=x.value.find(k=>k.id===p.value.car_id);g&&g.total_s&&(l=g.total_s)}p.value.expenses=l||0}}function se(){const a=new Date,t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0");return`${t}-${l}-${g}`}function Ne(a){if(!a)return"-";try{if(typeof a=="string"&&a.includes("T"))return a.split("T")[0];const t=new Date(a);if(isNaN(t.getTime()))return a;const l=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),k=String(t.getDate()).padStart(2,"0");return`${l}-${g}-${k}`}catch{return a}}function M(a){return a==null?"0":(typeof a=="number"?a:parseFloat(a)||0).toFixed(2).replace(/\.00$/,"")}async function K(){if(!!B.value){y.value=!0,x.value=[];try{const a=await q.get("/api/getUnsoldCars",{params:{client_id:B.value}});a.data&&a.data.cars&&Array.isArray(a.data.cars)&&(x.value=a.data.cars)}catch(a){console.error("Error loading unsold cars:",a),b.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{y.value=!1}}}async function H(){if(!!B.value){N.value=!0;try{const a=await q.get("/api/getInternalSales",{params:{client_id:B.value}});w.value=a.data.sales||[],$.value=a.data.totals||{},S.value=a.data.has_internal_sales||!1,a.data.client&&(ae.value=a.data.client)}catch(a){console.error("Error loading internal sales:",a),b.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{N.value=!1}}}async function Q(){O.value=!0;try{const a=await q.get("/api/getInternalSalesBuyers",{params:{client_id:B.value}});_.value=a.data.buyers||[]}catch(a){console.error("Error loading internal sales buyers:",a),b.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0632\u0628\u0627\u0626\u0646",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{O.value=!1}}async function ge(){if(!!B.value){i.value=!0;try{const a=await q.get("/api/getAllClients",{params:{client_id:B.value}});a.data&&a.data.clients?m.value=a.data.clients:C.clients&&Array.isArray(C.clients)&&(m.value=C.clients)}catch(a){console.error("Error loading clients:",a),C.clients&&Array.isArray(C.clients)&&(m.value=C.clients)}finally{i.value=!1}}}async function Be(){if(!!B.value)try{const a=await q.post("/api/toggleInternalSales",{client_id:B.value,has_internal_sales:!S.value});S.value=a.data.has_internal_sales,b.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:2e3,position:"bottom-right",rtl:!0}),S.value&&(H(),K())}catch(a){console.error("Error toggling internal sales:",a),b.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Ce(a=null){if(a&&a.id){const t={id:a.id,car_type:a.car_type,year:a.year,vin:a.vin,car_number:a.car_number,total_s:a.total_s||0,car_price:a.car_price||0};x.value=[t],await ge();const l=he.value.find(g=>g.value===a.id);p.value={client_id:B.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:(l==null?void 0:l.total_s)||a.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:se()},c.value=!1,I.value=!0;return}if(!a&&x.value.length===0&&await K(),await ge(),a&&a.id){const t=x.value.find(l=>l.id===a.id)||a;p.value={client_id:B.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:t.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:se()},c.value=!1,I.value=!0;return}p.value={client_id:B.value,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:se()},c.value=!1,I.value=!0}function we(){I.value=!1,p.value={client_id:null,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:se()},x.value=[],c.value=!1}function Te(a){ne.value=a,u.value=!0}function Ee(a){p.value=a,Pe()}async function Le(){var l,g;const a=p.value.client_id&&p.value.client_id!==""&&p.value.client_id!==null&&p.value.client_id!==void 0;if(!c.value&&!a){b.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(c.value&&!p.value.client_name){b.error("\u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!p.value.car_id){b.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629",{timeout:2e3,position:"bottom-right",rtl:!0});return}const t={...p.value};c.value?(t.client_id=null,t.client_name=t.client_name||"",t.client_phone=t.client_phone||""):(t.client_id=parseInt(t.client_id)||null,t.client_name=null,t.client_phone=null);try{await q.post("/api/addInternalSale",t),b.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),we(),H(),Q(),K()}catch(k){console.error("Error adding internal sale:",k),b.error(((g=(l=k.response)==null?void 0:l.data)==null?void 0:g.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Pe(){try{await q.post("/api/updateInternalSale",p.value),b.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),u.value=!1,H(),Q()}catch(a){console.error("Error updating internal sale:",a),b.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function De(a){if(!!confirm("\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629\u061F"))try{await q.post("/api/deleteInternalSale",{id:a.id}),b.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),H(),Q(),K()}catch(t){console.error("Error deleting internal sale:",t),b.error("\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Ae(a){const t=F.value.indexOf(a);t>-1?F.value.splice(t,1):F.value.push(a)}function qe(){const a=re.value.map(l=>l.id);a.length>0&&a.every(l=>F.value.includes(l))?F.value=F.value.filter(l=>!a.includes(l)):a.forEach(l=>{F.value.includes(l)||F.value.push(l)})}function Oe(){if(F.value.length===0){b.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}pe.value=!0}function Se(){pe.value=!1}async function Ye(a){var l,g;if(F.value.length===0){b.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!(a.car_price!==null||a.expenses!==null||a.additional_expenses!==null)){b.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0642\u064A\u0645\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const k={sale_ids:F.value,car_price:a.car_price,expenses:a.expenses,additional_expenses:a.additional_expenses};await q.post("/api/bulkUpdateInternalSales",k),b.success(`\u062A\u0645 \u062A\u0639\u062F\u064A\u0644 ${F.value.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),Se(),F.value=[],H(),Q()}catch(k){console.error("Error bulk updating internal sales:",k),b.error(((g=(l=k.response)==null?void 0:l.data)==null?void 0:g.error)||"\u0641\u0634\u0644 \u0627\u0644\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u062C\u0645\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Re(a){if(a.remaining_debt<=0){b.error("\u0644\u0627 \u064A\u0648\u062C\u062F \u062F\u064A\u0646 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646",{timeout:2e3,position:"bottom-right",rtl:!0});return}R.value=a,xe.value=!0}function Ue(){xe.value=!1,R.value=null}async function He(a){var g,k,Y,P,T;if(!R.value){b.error("\u0644\u0645 \u064A\u062A\u0645 \u062A\u062D\u062F\u064A\u062F \u0627\u0644\u0645\u0634\u062A\u0631\u064A",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!B.value){b.error("\u0644\u0645 \u064A\u062A\u0645 \u062A\u062D\u062F\u064A\u062F \u0627\u0644\u062A\u0627\u062C\u0631",{timeout:2e3,position:"bottom-right",rtl:!0}),console.error("currentClientId is missing:",{client_id:C.client_id,client:C.client});return}const t=typeof a=="object"?a.amount:a,l=typeof a=="object"&&a.note||"";if(!t||t<=0){b.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0635\u062D\u064A\u062D",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(t>R.value.remaining_debt){b.error("\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A",{timeout:2e3,position:"bottom-right",rtl:!0});return}ve.value=!0;try{const E={buyer_id:parseInt(R.value.id),merchant_id:parseInt(B.value),amount:parseFloat(t),note:l};console.log("Sending payment request:",E),await q.post("/api/addPaymentToBuyer",E),b.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),Ue(),H(),Q()}catch(E){console.error("Error adding payment:",{error:E,response:E.response,message:E.message,requestData:{buyer_id:(g=R.value)==null?void 0:g.id,merchant_id:B.value,amount:t}});const te=((Y=(k=E.response)==null?void 0:k.data)==null?void 0:Y.error)||((T=(P=E.response)==null?void 0:P.data)==null?void 0:T.message)||E.message||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629";b.error(te,{timeout:3e3,position:"bottom-right",rtl:!0})}finally{ve.value=!1}}function ze(a){R.value=a,_e.value=!0}function Ge(){_e.value=!1,R.value=null}function Je(){H(),Q()}function Ke(){x.value.length===0&&K(),ge(),h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:se()},fe.value=!0}function $e(){fe.value=!1,h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:se()}}function Qe(a){h.value.cars.findIndex(l=>l.car_id===a.id)===-1&&h.value.cars.push({car_id:a.id,car_type:a.car_type,year:a.year,vin:a.vin||a.car_number,total_s:a.total_s||0,sale_price:0,paid_amount:0,expenses:a.total_s||0,additional_expenses:0})}function We(a){h.value.cars.splice(a,1)}async function Xe(){var a,t;if(!h.value.client_id&&!h.value.client_name){b.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(h.value.cars.length===0){b.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const l={client_id:h.value.client_id,client_name:h.value.client_name||null,client_phone:h.value.client_phone||null,cars:h.value.cars,sale_date:h.value.sale_date};await q.post("/api/addBulkInternalSale",l),b.success(`\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 ${h.value.cars.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),$e(),H(),Q(),K()}catch(l){console.error("Error adding bulk sale:",l),b.error(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}}return Ze(()=>{if(B.value){H(),Q(),K(),ge();const t=new URLSearchParams(window.location.search).get("car_id");t&&setTimeout(async()=>{await K();const l=x.value.find(k=>k.id==t);l&&Ce(l);const g=window.location.pathname;window.history.replaceState({},"",g)},500)}}),(a,t)=>(s(),d(z,null,[n(r(et),{title:"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629"}),n(lt,null,{header:L(()=>{var l;return[e("div",Yt,[e("h2",Rt," \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 - "+o(((l=C.client)==null?void 0:l.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),n(r(tt),{href:`/showClients/${B.value}`,class:"text-blue-600 hover:text-blue-800 dark:text-blue-400"},{default:L(()=>[...t[25]||(t[25]=[ie(" \u0627\u0644\u0639\u0648\u062F\u0629 \u0625\u0644\u0649 \u0635\u0641\u062D\u0629 \u0627\u0644\u062A\u0627\u062C\u0631 ",-1)])]),_:1},8,["href"])])]}),default:L(()=>[e("div",Ht,[e("div",zt,[e("div",Gt,[t[28]||(t[28]=e("h2",{class:"text-xl font-bold dark:text-gray-400"},"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Jt,[e("label",Kt,[t[27]||(t[27]=e("span",{class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},"\u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Qt,[e("input",{type:"checkbox",class:"sr-only peer",checked:r(S),onChange:Be},null,40,Wt),t[26]||(t[26]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])])])]),r(S)&&r(w).length>0?(s(),d("div",Xt,[t[38]||(t[38]=e("h3",{class:"text-lg font-bold mb-4 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Zt,[e("div",el,[e("div",tl,[e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",-1)),e("p",ll,o(M(ee.value.totalSales))+" $",1)]),t[30]||(t[30]=e("div",{class:"text-blue-500 text-3xl"},"\u{1F4B0}",-1))])]),e("div",al,[e("div",rl,[e("div",null,[t[31]||(t[31]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),e("p",sl,o(M(ee.value.totalExpenses))+" $",1)]),t[32]||(t[32]=e("div",{class:"text-orange-500 text-3xl"},"\u{1F4CA}",-1))])]),e("div",ol,[e("div",nl,[e("div",null,[t[33]||(t[33]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0631\u0628\u062D",-1)),e("p",{class:W(["text-2xl font-bold",ee.value.totalProfit>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},o(M(ee.value.totalProfit))+" $ ",3)]),t[34]||(t[34]=e("div",{class:"text-green-500 text-3xl"},"\u{1F4C8}",-1))])]),e("div",dl,[e("div",il,[e("div",null,[t[35]||(t[35]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A",-1)),e("p",ul,o(M(ee.value.totalDebt))+" $",1)]),t[36]||(t[36]=e("div",{class:"text-red-500 text-3xl"},"\u26A0\uFE0F",-1))])])]),ee.value.carTypes.length>0?(s(),d("div",cl,[t[37]||(t[37]=e("h4",{class:"text-md font-bold mb-3 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u0628\u0627\u0639\u0629",-1)),e("div",pl,[(s(!0),d(z,null,X(ee.value.carTypes,l=>(s(),d("div",{key:l.type,class:"bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600"},[e("p",gl,o(l.type),1),e("p",ml,o(l.count)+" \u0633\u064A\u0627\u0631\u0629",1)]))),128))])])):j("",!0)])):j("",!0),r(S)&&r(x).length>0?(s(),d("div",yl,[e("div",bl,[e("h3",xl,"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ("+o(r(x).length)+")",1),e("button",{onClick:t[0]||(t[0]=l=>Ke()),class:"px-3 py-1 text-sm text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0628\u064A\u0639 \u0645\u062C\u0645\u0639 ")]),e("div",_l,[e("div",vl,[n(f,{for:"search_unsold_cars",value:"\u0628\u062D\u062B \u0641\u064A \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629:",class:"!mb-0"}),n(U,{id:"search_unsold_cars",modelValue:r(A),"onUpdate:modelValue":t[1]||(t[1]=l=>oe(A)?A.value=l:A=l),type:"text",placeholder:"\u0627\u0628\u062D\u062B \u0628\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)\u060C \u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0627\u0644\u0633\u0646\u0629...",class:"flex-1"},null,8,["modelValue"]),r(A)?(s(),d("button",{key:0,onClick:t[2]||(t[2]=l=>oe(A)?A.value="":A=""),class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}," \u2715 ")):j("",!0)]),r(A)?(s(),d("p",fl," \u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 "+o(ke.value.length)+" \u0645\u0646 "+o(r(x).length)+" \u0633\u064A\u0627\u0631\u0629 ",1)):j("",!0)]),r(y)?(s(),d("div",hl,[...t[39]||(t[39]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"},null,-1)])])):r(x).length===0?(s(),d("div",kl," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 \u062D\u0627\u0644\u064A\u0627\u064B ")):ke.value.length===0?(s(),d("div",wl,[r(A)?(s(),d("span",$l,'\u0644\u0627 \u062A\u0648\u062C\u062F \u0646\u062A\u0627\u0626\u062C \u0644\u0644\u0628\u062D\u062B "'+o(r(A))+'"',1)):(s(),d("span",Vl,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 \u062D\u0627\u0644\u064A\u0627\u064B"))])):(s(),d("div",Cl,[e("table",Sl,[t[41]||(t[41]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center sticky top-0"},[e("tr",null,[e("th",{class:"px-2 py-3"},"\u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u0646\u0629"),e("th",{class:"px-2 py-3"},"\u0631\u0642\u0645 \u0627\u0644\u0634\u0627\u0635\u064A / \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u062A\u0643\u0644\u0641\u0629 (Total S)"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(s(!0),d(z,null,X(ke.value,l=>(s(),d("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",Ul,o(l.car_type),1),e("td",Il,o(l.year),1),e("td",jl,[e("div",Fl,o(l.vin),1),l.car_number?(s(),d("div",Ml,o(l.car_number),1)):j("",!0)]),e("td",Nl,o(M(l.total_s))+" $",1),e("td",Bl,[e("button",{onClick:g=>Ce(l),class:"px-3 py-1 text-white bg-blue-600 rounded hover:bg-blue-700 text-xs flex items-center justify-center mx-auto gap-1"},[...t[40]||(t[40]=[e("span",{class:"text-lg"},"+",-1),ie(" \u0628\u064A\u0639 ",-1)])],8,Tl)])]))),128))])])]))])):j("",!0),r(S)?(s(),d("div",El,[r(I)?(s(),d("div",Ll,[e("div",{class:"flex justify-between items-center mb-4"},[t[42]||(t[42]=e("h3",{class:"text-lg font-bold dark:text-gray-100"},"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("button",{onClick:we,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," \u2715 ")]),e("div",Pl,[e("div",null,[e("div",Dl,[n(f,{for:"client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[3]||(t[3]=l=>oe(c)?c.value=!r(c):c=!r(c)),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors duration-200 flex items-center gap-1"},[r(c)?(s(),d("span",ql,[...t[44]||(t[44]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),ie(" \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F ",-1)])])):(s(),d("span",Al,[...t[43]||(t[43]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ie(" \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F ",-1)])]))])]),r(c)?(s(),d("div",Yl,[e("div",null,[n(f,{for:"client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),n(U,{id:"client_name",modelValue:r(p).client_name,"onUpdate:modelValue":t[5]||(t[5]=l=>r(p).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[n(f,{for:"client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),n(U,{id:"client_phone",modelValue:r(p).client_phone,"onUpdate:modelValue":t[6]||(t[6]=l=>r(p).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(s(),d("div",Ol,[n(r(ye),{modelValue:r(p).client_id,"onUpdate:modelValue":t[4]||(t[4]=l=>r(p).client_id=l),list:Ve.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":r(i),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[n(f,{for:"car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),n(r(ye),{modelValue:r(p).car_id,"onUpdate:modelValue":t[7]||(t[7]=l=>r(p).car_id=l),list:he.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0633\u064A\u0627\u0631\u0629 \u0628\u0627\u0644\u0634\u0627\u0646\u0635 (VIN) \u0623\u0648 \u0627\u0644\u0643\u0627\u062A\u064A (\u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629)...","is-disabled":r(y),onChange:Me,class:"dark:bg-gray-700 dark:text-gray-100"},null,8,["modelValue","list","is-disabled"])]),e("div",null,[G(e("input",{type:"hidden","onUpdate:modelValue":t[8]||(t[8]=l=>r(p).car_price=l)},null,512),[[J,r(p).car_price]])]),G(e("input",{type:"hidden","onUpdate:modelValue":t[9]||(t[9]=l=>r(p).shipping=l)},null,512),[[J,r(p).shipping]]),e("div",null,[n(f,{for:"sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),n(U,{id:"sale_price",type:"number",step:"0.01",modelValue:r(p).sale_price,"onUpdate:modelValue":t[10]||(t[10]=l=>r(p).sale_price=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),n(U,{id:"paid_amount",type:"number",step:"0.01",modelValue:r(p).paid_amount,"onUpdate:modelValue":t[11]||(t[11]=l=>r(p).paid_amount=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),r(p).paid_amount>0?(s(),d("div",Rl,[n(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),G(e("textarea",{id:"payment_note","onUpdate:modelValue":t[12]||(t[12]=l=>r(p).payment_note=l),rows:"2",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 \u0627\u0644\u0623\u0648\u0644\u0649 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[J,r(p).payment_note]])])):j("",!0),G(e("input",{type:"hidden","onUpdate:modelValue":t[13]||(t[13]=l=>r(p).expenses=l)},null,512),[[J,r(p).expenses]]),e("div",null,[n(f,{for:"additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),n(U,{id:"additional_expenses",type:"number",step:"0.01",modelValue:r(p).additional_expenses,"onUpdate:modelValue":t[14]||(t[14]=l=>r(p).additional_expenses=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[n(f,{for:"sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),n(U,{id:"sale_date",type:"date",modelValue:r(p).sale_date,"onUpdate:modelValue":t[15]||(t[15]=l=>r(p).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",Hl,[n(f,{for:"note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),G(e("textarea",{id:"note","onUpdate:modelValue":t[16]||(t[16]=l=>r(p).note=l),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[J,r(p).note]])])]),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{onClick:we,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:Le,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800"}," \u0625\u0636\u0627\u0641\u0629 ")])])):j("",!0),t[62]||(t[62]=e("div",{class:"mb-4 flex justify-end"},null,-1)),r(N)?(s(),d("div",zl,[...t[45]||(t[45]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A...",-1)])])):(s(),d("div",Gl,[e("div",Jl,[e("div",Kl,[n(f,{for:"search_sale",value:"\u0628\u062D\u062B \u0639\u0646 \u0628\u064A\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629:",class:"!mb-0"}),n(U,{id:"search_sale",modelValue:r(D),"onUpdate:modelValue":t[17]||(t[17]=l=>oe(D)?D.value=l:D=l),type:"text",placeholder:"\u0627\u0628\u062D\u062B \u0628\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)\u060C \u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0627\u0633\u0645 \u0627\u0644\u0632\u0628\u0648\u0646...",class:"flex-1"},null,8,["modelValue"]),r(D)?(s(),d("button",{key:0,onClick:t[18]||(t[18]=l=>oe(D)?D.value="":D=""),class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}," \u2715 ")):j("",!0)]),r(D)?(s(),d("p",Ql," \u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 "+o(re.value.length)+" \u0645\u0646 "+o(r(w).length)+" \u0645\u0628\u064A\u0639\u0629 ",1)):j("",!0)]),r(F).length>0?(s(),d("div",Wl,[e("span",Xl," \u062A\u0645 \u0627\u062E\u062A\u064A\u0627\u0631 "+o(r(F).length)+" \u0645\u0628\u064A\u0639\u0629 ",1),e("button",{onClick:Oe,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ")])):j("",!0),e("table",Zl,[e("thead",ea,[e("tr",null,[e("th",ta,[e("input",{type:"checkbox",checked:r(F).length===re.value.length&&re.value.length>0,onChange:qe,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,la)]),t[46]||(t[46]=e("th",{class:"px-2 py-3"},"#",-1)),t[47]||(t[47]=e("th",{class:"px-2 py-3"},"\u0627\u0633\u0645 \u0627\u0644\u0632\u0628\u0648\u0646 \u0627\u0644\u0645\u0634\u062A\u0631\u064A",-1)),t[48]||(t[48]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[49]||(t[49]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)",-1)),t[50]||(t[50]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[51]||(t[51]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639",-1)),t[52]||(t[52]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639",-1)),t[53]||(t[53]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),t[54]||(t[54]=e("th",{class:"px-2 py-3"},"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629",-1)),t[55]||(t[55]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0631\u0628\u062D",-1)),t[56]||(t[56]=e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639",-1)),t[57]||(t[57]=e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0627\u062A",-1)),t[58]||(t[58]=e("th",{class:"px-2 py-3 print:hidden"},"\u062A\u0646\u0641\u064A\u0630",-1))])]),e("tbody",null,[(s(!0),d(z,null,X(re.value,(l,g)=>{var k,Y,P,T,E,te,de;return s(),d("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",aa,[e("input",{type:"checkbox",checked:r(F).includes(l.id),onChange:le=>Ae(l.id),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,ra)]),e("td",sa,o(g+1),1),e("td",oa,[e("div",null,o(((k=l.client)==null?void 0:k.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),(Y=l.client)!=null&&Y.phone?(s(),d("div",na,o((P=l.client)==null?void 0:P.phone),1)):j("",!0)]),e("td",da,o((T=l.car)==null?void 0:T.car_type)+" "+o((E=l.car)==null?void 0:E.year),1),e("td",ia,o(((te=l.car)==null?void 0:te.vin)||((de=l.car)==null?void 0:de.car_number)||"-"),1),e("td",ua,o(M(l.car_price))+" $",1),e("td",ca,o(M(l.sale_price))+" $",1),e("td",pa,o(M(l.paid_amount))+" $",1),e("td",ga,o(M(l.expenses))+" $",1),e("td",ma,o(M(l.additional_expenses))+" $",1),e("td",{class:W(["px-2 py-3 font-bold",(parseFloat(l.profit)||0)>=0?"text-green-600":"text-red-600"])},o(M(l.profit))+" $ ",3),e("td",ya,o(Ne(l.sale_date||l.created_at)),1),e("td",ba,[l.note?(s(),d("div",xa,o(l.note),1)):j("",!0),l.payment_notes&&l.payment_notes.length>0?(s(),d("div",_a,[(s(!0),d(z,null,X(l.payment_notes,(le,me)=>(s(),d("div",{key:me,class:"mt-1"},[t[59]||(t[59]=e("span",{class:"font-semibold"},"\u062F\u0641\u0639\u0629:",-1)),ie(" "+o(le),1)]))),128))])):j("",!0)]),e("td",va,[e("button",{onClick:le=>Te(l),class:"px-2 py-1 text-white bg-blue-500 rounded hover:bg-blue-600 mr-1"},[n(at,{class:"w-4 h-4 inline"})],8,fa),e("button",{onClick:le=>De(l),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600"},[n(Fe,{class:"w-4 h-4 inline"})],8,ha)])])}),128)),re.value.length===0?(s(),d("tr",ka,[e("td",wa,[r(D)?(s(),d("span",$a,'\u0644\u0627 \u062A\u0648\u062C\u062F \u0646\u062A\u0627\u0626\u062C \u0644\u0644\u0628\u062D\u062B "'+o(r(D))+'"',1)):(s(),d("span",Va,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u0628\u064A\u0639\u0627\u062A \u062F\u0627\u062E\u0644\u064A\u0629"))])])):j("",!0)]),r(w).length>0?(s(),d("tfoot",Ca,[e("tr",null,[t[60]||(t[60]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A:",-1)),e("td",Sa,o(M(r(w).reduce((l,g)=>l+(parseFloat(g.car_price)||0),0)))+" $",1),e("td",Ua,o(M(r($).total_sales))+" $",1),e("td",Ia,o(M(r($).total_paid))+" $",1),e("td",ja,o(M(r($).total_expenses))+" $",1),e("td",Fa,o(M(r(w).reduce((l,g)=>l+(parseFloat(g.additional_expenses)||0),0)))+" $",1),e("td",{class:W(["px-2 py-3",(parseFloat(r($).total_profit)||0)>=0?"text-green-600":"text-red-600"])},o(M(r($).total_profit))+" $ ",3),t[61]||(t[61]=e("td",{colspan:"3"},null,-1))])])):j("",!0)])]))])):j("",!0),r(S)&&r(_).length>0?(s(),d("div",Ma,[t[66]||(t[66]=e("h3",{class:"text-lg font-bold mb-4 dark:text-blue-300"},"\u0627\u0644\u0632\u0628\u0627\u0626\u0646 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0648\u0646 \u0641\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),r(O)?(s(),d("div",Na,[...t[63]||(t[63]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(s(),d("div",Ba,[(s(!0),d(z,null,X(r(_),l=>(s(),d("div",{key:l.id,class:W(["p-4 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-md",l.remaining_debt>0?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"])},[e("div",Ta,[e("div",null,[e("h4",Ea,o(l.name),1),e("p",La,o(l.phone),1)]),e("div",{class:W(["text-center bg-white dark:bg-gray-800 rounded-full px-3 py-1 text-xs font-bold border",l.remaining_debt>0?"text-red-600 border-red-100":"text-green-600 border-green-100"])},o(l.sales_count)+" \u0633\u064A\u0627\u0631\u0629 ",3)]),e("div",Pa,[e("div",Da,[t[64]||(t[64]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",Aa,o(M(l.total_sales))+" $",1)]),e("div",qa,[t[65]||(t[65]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",Oa,o(M(l.total_paid))+" $",1)]),e("div",Ya,[e("span",{class:W(l.remaining_debt>0?"text-red-600":"text-green-600")},o(l.remaining_debt>0?"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):":"\u0648\u0627\u0635\u0644:"),3),e("span",{class:W(l.remaining_debt>0?"text-red-600":"text-green-600")},o(M(Math.abs(l.remaining_debt)))+" $ ",3)])]),e("div",Ra,[e("div",Ha,[l.remaining_debt>0?(s(),d("button",{key:0,onClick:g=>Re(l),class:"flex-1 px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 font-medium text-sm"}," \u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 ",8,za)):j("",!0),e("button",{onClick:g=>ze(l),class:"flex-1 px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 font-medium text-sm"}," \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 ",8,Ga)])])],2))),128))]))])):r(S)?j("",!0):(s(),d("div",Ja," \u064A\u062C\u0628 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0623\u0648\u0644\u0627\u064B "))])]),n(st,{show:r(u),sale:r(ne),clients:r(m).map(l=>({value:l.id,text:`${l.name||""}${l.phone?" - "+l.phone:""}`,name:l.name||"",phone:l.phone||""})),onClose:t[19]||(t[19]=l=>oe(u)?u.value=!1:u=!1),onUpdate:Ee},null,8,["show","sale","clients"]),n(Ot,{show:r(pe),"selected-count":r(F).length,onClose:Se,onConfirm:Ye},null,8,["show","selected-count"]),n(wt,{show:r(xe),buyer:r(R),"merchant-id":B.value,"is-loading":r(ve),onClose:Ue,onConfirm:He},null,8,["show","buyer","merchant-id","is-loading"]),n(Dt,{show:r(_e),buyer:r(R),"merchant-id":B.value,onClose:Ge,onRefresh:Je},null,8,["show","buyer","merchant-id"]),n(ce,{show:r(fe),onClose:$e},{header:L(()=>[...t[67]||(t[67]=[e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u0628\u064A\u0639 \u0645\u062C\u0645\u0639 - \u0628\u064A\u0639 \u0639\u062F\u0629 \u0633\u064A\u0627\u0631\u0627\u062A \u0644\u0646\u0641\u0633 \u0627\u0644\u0632\u0628\u0648\u0646",-1)])]),body:L(()=>[e("div",Ka,[e("div",null,[e("div",Qa,[n(f,{for:"bulk_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[20]||(t[20]=l=>r(h).showNewClientForm=!r(h).showNewClientForm),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},[r(h).showNewClientForm?(s(),d("span",Xa,"\u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F")):(s(),d("span",Wa,"+ \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F"))])]),r(h).showNewClientForm?(s(),d("div",er,[e("div",null,[n(f,{for:"bulk_client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),n(U,{id:"bulk_client_name",modelValue:r(h).client_name,"onUpdate:modelValue":t[22]||(t[22]=l=>r(h).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[n(f,{for:"bulk_client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),n(U,{id:"bulk_client_phone",modelValue:r(h).client_phone,"onUpdate:modelValue":t[23]||(t[23]=l=>r(h).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(s(),d("div",Za,[n(r(ye),{modelValue:r(h).client_id,"onUpdate:modelValue":t[21]||(t[21]=l=>r(h).client_id=l),list:Ve.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":r(i),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[n(f,{for:"bulk_car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629"}),r(y)?(s(),d("div",tr,[...t[68]||(t[68]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):r(x).length===0?(s(),d("div",lr," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ")):(s(),d("div",ar,[(s(!0),d(z,null,X(r(x),l=>(s(),d("div",{key:l.id,class:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded mb-1"},[e("div",rr,[e("span",sr,o(l.car_type)+" "+o(l.year),1),e("span",or,"- "+o(l.vin||l.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"),1),e("span",nr,"("+o(M(l.total_s))+" $)",1)]),e("button",{onClick:g=>Qe(l),disabled:r(h).cars.some(g=>g.car_id===l.id),class:"px-3 py-1 text-xs text-white bg-green-600 rounded hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},o(r(h).cars.some(g=>g.car_id===l.id)?"\u0645\u0636\u0627\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629"),9,dr)]))),128))]))]),r(h).cars.length>0?(s(),d("div",ir,[n(f,{value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629"}),e("div",ur,[(s(!0),d(z,null,X(r(h).cars,(l,g)=>(s(),d("div",{key:g,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700"},[e("div",cr,[e("div",null,[e("p",pr,o(l.car_type)+" "+o(l.year),1),e("p",gr,o(l.vin),1)]),e("button",{onClick:k=>We(g),class:"text-red-600 hover:text-red-800 text-sm"}," \u2715 \u062D\u0630\u0641 ",8,mr)]),e("div",yr,[e("div",null,[n(f,{for:`sale_price_${g}`,value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)",class:"text-xs"},null,8,["for"]),n(U,{id:`sale_price_${g}`,type:"number",step:"0.01",modelValue:l.sale_price,"onUpdate:modelValue":k=>l.sale_price=k,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])]),e("div",null,[n(f,{for:`paid_amount_${g}`,value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)",class:"text-xs"},null,8,["for"]),n(U,{id:`paid_amount_${g}`,type:"number",step:"0.01",modelValue:l.paid_amount,"onUpdate:modelValue":k=>l.paid_amount=k,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])])])]))),128))])])):j("",!0),e("div",null,[n(f,{for:"bulk_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),n(U,{id:"bulk_sale_date",type:"date",modelValue:r(h).sale_date,"onUpdate:modelValue":t[24]||(t[24]=l=>r(h).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:L(()=>[e("div",br,[e("button",{onClick:$e,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:Xe,class:"px-4 py-2 text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A ("+o(r(h).cars.length)+") ",1)])]),_:1},8,["show"])]),_:1})],64))}};export{Ir as default};
