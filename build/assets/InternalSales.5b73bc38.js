import{r as v,E as de,o as n,c as be,w as N,b as e,g as s,j as r,e as R,v as z,q as ee,t as o,a as i,i as B,n as K,x as Se,F as H,h as Q,m as We,H as Xe,L as Ze,f as ne,k as ge}from"./app.4634e08a.js";import{_ as et}from"./AuthenticatedLayout.50f9247e.js";import{M as ie}from"./Modal.52b2b208.js";import{_ as f}from"./InputLabel.44f20ce2.js";import{_ as S}from"./TextInput.bc1e6fa0.js";import{q as me}from"./VueSearchSelect.0c32bcf0.js";/* empty css                        */import{a as P}from"./index.99c0f2ce.js";import{t as Ue}from"./trash.ad90075c.js";import{e as tt}from"./edit.cd80b400.js";/* empty css                                              */const lt={class:"space-y-4"},at={__name:"ModalEditInternalSale",props:{show:Boolean,sale:Object,clients:Array},emits:["close","update"],setup(V,{emit:y}){const U=V,I=y,u=v({id:null,client_id:null,client_name:"",client_phone:"",car_id:null,car_name:"",car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",sale_date:""}),k=v(!1);function w(){const b=new Date,g=b.getFullYear(),d=String(b.getMonth()+1).padStart(2,"0"),c=String(b.getDate()).padStart(2,"0");return`${g}-${d}-${c}`}function C(b){if(!b)return w();try{if(typeof b=="string"&&b.includes("T"))return b.split("T")[0];const g=new Date(b);if(isNaN(g.getTime()))return b;const d=g.getFullYear(),c=String(g.getMonth()+1).padStart(2,"0"),x=String(g.getDate()).padStart(2,"0");return`${d}-${c}-${x}`}catch{return b}}de(()=>U.sale,b=>{b&&(u.value={id:b.id,client_id:b.client_id,car_id:b.car_id,car_name:b.car?`${b.car.car_type} ${b.car.year} - ${b.car.vin||b.car.car_number}`:"",car_price:b.car_price||0,shipping:b.shipping||0,sale_price:b.sale_price,paid_amount:b.paid_amount,expenses:b.expenses,additional_expenses:b.additional_expenses||0,note:b.note||"",sale_date:C(b.sale_date||b.created_at),client_name:"",client_phone:""},k.value=!1)},{deep:!0,immediate:!0});function M(){I("update",u.value)}function _(){I("close")}return(b,g)=>(n(),be(ie,{show:V.show,onClose:_},{header:N(()=>[g[11]||(g[11]=e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u062A\u0639\u062F\u064A\u0644 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",lt,[e("div",null,[s(f,{for:"edit_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644"}),s(r(me),{modelValue:u.value.client_id,"onUpdate:modelValue":g[0]||(g[0]=d=>u.value.client_id=d),list:V.clients,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644...",class:"dark:bg-gray-800 dark:text-gray-100"},null,8,["modelValue","list"])]),e("div",null,[s(f,{for:"car_display_edit",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),s(S,{id:"car_display_edit",type:"text",modelValue:u.value.car_name,"onUpdate:modelValue":g[1]||(g[1]=d=>u.value.car_name=d),class:"mt-1 block w-full bg-gray-100 dark:bg-gray-800 cursor-not-allowed text-gray-500 dark:text-gray-400",disabled:""},null,8,["modelValue"])]),e("div",null,[R(e("input",{type:"hidden","onUpdate:modelValue":g[2]||(g[2]=d=>u.value.car_id=d)},null,512),[[z,u.value.car_id]])]),e("div",null,[s(f,{for:"edit_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),s(S,{id:"edit_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":g[3]||(g[3]=d=>u.value.car_price=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[R(e("input",{type:"hidden","onUpdate:modelValue":g[4]||(g[4]=d=>u.value.shipping=d)},null,512),[[z,u.value.shipping]])]),e("div",null,[s(f,{for:"edit_sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),s(S,{id:"edit_sale_price",type:"number",step:"0.01",modelValue:u.value.sale_price,"onUpdate:modelValue":g[5]||(g[5]=d=>u.value.sale_price=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"edit_paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),s(S,{id:"edit_paid_amount",type:"number",step:"0.01",modelValue:u.value.paid_amount,"onUpdate:modelValue":g[6]||(g[6]=d=>u.value.paid_amount=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"edit_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),s(S,{id:"edit_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":g[7]||(g[7]=d=>u.value.expenses=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"edit_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),s(S,{id:"edit_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":g[8]||(g[8]=d=>u.value.additional_expenses=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"edit_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),s(S,{id:"edit_sale_date",type:"date",modelValue:u.value.sale_date,"onUpdate:modelValue":g[9]||(g[9]=d=>u.value.sale_date=d),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"edit_note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),R(e("textarea",{id:"edit_note","onUpdate:modelValue":g[10]||(g[10]=d=>u.value.note=d),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"},null,512),[[z,u.value.note]])])])]),footer:N(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:_,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:M,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u062D\u062F\u064A\u062B ")])]),_:1},8,["show"]))}},rt={class:"text-xl font-bold dark:text-gray-100"},st={key:0,class:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},ot={class:"text-sm space-y-1"},nt={class:"flex justify-between"},dt={class:"font-medium"},it={class:"flex justify-between"},ut={class:"font-medium text-green-600"},ct={class:"flex justify-between font-bold text-lg pt-2 border-t"},pt={class:"text-red-600"},gt={class:"space-y-4"},mt={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},bt={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},yt={class:"flex justify-end gap-2"},xt=["disabled"],_t=["disabled"],vt={key:0},ft={key:1},ht={__name:"ModalAddPayment",props:{show:Boolean,buyer:Object,merchantId:[String,Number],isLoading:Boolean},emits:["close","confirm"],setup(V,{emit:y}){const U=V,I=y,u=v(0),k=v(""),w=v(""),C=ee(()=>!U.buyer||!U.buyer.remaining_debt?0:Math.abs(U.buyer.remaining_debt)),M=ee(()=>{const d=parseFloat(u.value)||0;return d<=0?(w.value="\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0635\u0641\u0631",!1):d>C.value?(w.value=`\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A (${_(C.value)} $)`,!1):(w.value="",!0)});de(()=>U.show,d=>{d&&(u.value=0,k.value="",w.value="")}),de(u,()=>{u.value?M.value:w.value=""});function _(d){return d==null?"0":(typeof d=="number"?d:parseFloat(d)||0).toFixed(2).replace(/\.00$/,"")}function b(){I("close")}function g(){!M.value||I("confirm",{amount:parseFloat(u.value)||0,note:k.value||""})}return(d,c)=>(n(),be(ie,{show:V.show,onClose:b},{header:N(()=>{var x;return[e("h2",rt,"\u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 - "+o((x=V.buyer)==null?void 0:x.name),1)]}),body:N(()=>[V.buyer?(n(),i("div",st,[e("div",ot,[e("div",nt,[c[2]||(c[2]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",dt,o(_(V.buyer.total_sales))+" $",1)]),e("div",it,[c[3]||(c[3]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",ut,o(_(V.buyer.total_paid))+" $",1)]),e("div",ct,[c[4]||(c[4]=e("span",{class:"text-red-600"},"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):",-1)),e("span",pt,o(_(Math.abs(V.buyer.remaining_debt)))+" $",1)])])])):B("",!0),e("div",gt,[e("div",null,[s(f,{for:"payment_amount",value:"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639 ($)"}),s(S,{id:"payment_amount",type:"number",step:"0.01",min:"0",modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=x=>u.value=x),max:C.value,placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639",class:K(["mt-1 block w-full",w.value?"border-red-500 focus:border-red-500 focus:ring-red-500":""])},null,8,["modelValue","max","class"]),w.value?(n(),i("p",mt,o(w.value),1)):(n(),i("p",bt," \u0627\u0644\u062D\u062F \u0627\u0644\u0623\u0642\u0635\u0649: "+o(_(C.value))+" $ ",1))]),e("div",null,[s(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),R(e("textarea",{id:"payment_note","onUpdate:modelValue":c[1]||(c[1]=x=>k.value=x),rows:"3",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[z,k.value]])])])]),footer:N(()=>[e("div",yt,[e("button",{onClick:b,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",disabled:V.isLoading}," \u0625\u0644\u063A\u0627\u0621 ",8,xt),e("button",{onClick:g,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V.isLoading||!M.value||!u.value||u.value<=0},[V.isLoading?(n(),i("span",vt,"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...")):(n(),i("span",ft,"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639"))],8,_t)])]),_:1},8,["show"]))}},kt={class:"text-xl font-bold dark:text-gray-100"},wt={key:0,class:"text-center py-4"},$t={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},Vt={key:2,class:"overflow-x-auto"},Ct={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},St={class:"px-2 py-3"},Ut={class:"px-2 py-3"},It={class:"px-2 py-3 font-mono text-xs"},jt={class:"px-2 py-3 text-green-600 font-bold"},Ft={class:"px-2 py-3"},Mt={class:"px-2 py-3 text-sm"},Bt={class:"px-2 py-3"},Et=["onClick"],Nt={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},Tt={class:"px-2 py-3 text-green-600"},Dt={__name:"ModalPaymentDetails",props:{show:Boolean,buyer:Object,merchantId:[String,Number]},emits:["close","refresh"],setup(V,{emit:y}){const U=Se(),I=V,u=y,k=v([]),w=v(!1);de(()=>I.show,d=>{d&&I.buyer&&I.merchantId?_():k.value=[]});function C(d){return d==null?"0":(typeof d=="number"?d:parseFloat(d)||0).toFixed(2).replace(/\.00$/,"")}function M(d){if(!d)return"-";try{if(typeof d=="string"&&d.includes("T"))return d.split("T")[0];const c=new Date(d);if(isNaN(c.getTime()))return d;const x=c.getFullYear(),A=String(c.getMonth()+1).padStart(2,"0"),te=String(c.getDate()).padStart(2,"0");return`${x}-${A}-${te}`}catch{return d}}async function _(){if(!(!I.buyer||!I.merchantId)){w.value=!0;try{const d=await P.get("/api/getBuyerPaymentDetails",{params:{buyer_id:I.buyer.id,merchant_id:I.merchantId}});k.value=d.data.payments||[]}catch(d){console.error("Error loading payment details:",d),k.value=[],U.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{w.value=!1}}}async function b(d){var c,x;if(!!confirm(`\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0642\u064A\u0645\u0629 ${C(d.amount)} $\u061F`))try{await P.post("/api/deletePayment",{sale_id:d.sale_id,payment_id:d.id}),U.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),await _(),u("refresh")}catch(A){console.error("Error deleting payment:",A),U.error(((x=(c=A.response)==null?void 0:c.data)==null?void 0:x.error)||"\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function g(){u("close")}return(d,c)=>(n(),be(ie,{show:V.show,onClose:g},{header:N(()=>{var x;return[e("h2",kt,"\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 - "+o((x=V.buyer)==null?void 0:x.name),1)]}),body:N(()=>[w.value?(n(),i("div",wt,[...c[0]||(c[0]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):k.value.length===0?(n(),i("div",$t," \u0644\u0627 \u062A\u0648\u062C\u062F \u062F\u0641\u0639\u0627\u062A \u0645\u0633\u062C\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646 ")):(n(),i("div",Vt,[e("table",Ct,[c[3]||(c[3]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},[e("tr",null,[e("th",{class:"px-2 py-3"},"#"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A"),e("th",{class:"px-2 py-3"},"\u0645\u0628\u0644\u063A \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u062F\u0641\u0639\u0629"),e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0629"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(n(!0),i(H,null,Q(k.value,(x,A)=>{var te,p,re,j;return n(),i("tr",{key:x.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",St,o(A+1),1),e("td",Ut,o((te=x.car)==null?void 0:te.car_type)+" "+o((p=x.car)==null?void 0:p.year),1),e("td",It,o(((re=x.car)==null?void 0:re.vin)||((j=x.car)==null?void 0:j.car_number)||"-"),1),e("td",jt,o(C(x.amount))+" $",1),e("td",Ft,o(M(x.date)),1),e("td",Mt,o(x.note||"-"),1),e("td",Bt,[e("button",{onClick:ue=>b(x),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600",title:"\u062D\u0630\u0641 \u0627\u0644\u062F\u0641\u0639\u0629"},[s(Ue,{class:"w-4 h-4 inline"})],8,Et)])])}),128))]),k.value.length>0?(n(),i("tfoot",Nt,[e("tr",null,[c[1]||(c[1]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u062F\u0641\u0639\u0627\u062A:",-1)),e("td",Tt,o(C(k.value.reduce((x,A)=>x+(parseFloat(A.amount)||0),0)))+" $ ",1),c[2]||(c[2]=e("td",{colspan:"3"},null,-1))])])):B("",!0)])]))]),footer:N(()=>[e("div",{class:"flex justify-end"},[e("button",{onClick:g,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u063A\u0644\u0627\u0642 ")])]),_:1},8,["show"]))}},Pt={class:"text-xl font-bold dark:text-gray-100"},At={class:"space-y-4"},Lt={__name:"ModalBulkEditInternalSales",props:{show:Boolean,selectedCount:Number},emits:["close","confirm"],setup(V,{emit:y}){const U=V,I=y,u=v({car_price:null,expenses:null,additional_expenses:null});de(()=>U.show,C=>{C&&(u.value={car_price:null,expenses:null,additional_expenses:null})});function k(){I("close")}function w(){I("confirm",{car_price:u.value.car_price!==null?parseFloat(u.value.car_price):null,expenses:u.value.expenses!==null?parseFloat(u.value.expenses):null,additional_expenses:u.value.additional_expenses!==null?parseFloat(u.value.additional_expenses):null})}return(C,M)=>(n(),be(ie,{show:V.show,onClose:k},{header:N(()=>[e("h2",Pt,"\u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ("+o(V.selectedCount)+" \u0645\u0628\u064A\u0639\u0629)",1)]),body:N(()=>[M[3]||(M[3]=e("div",{class:"mb-4 text-sm text-gray-600 dark:text-gray-400"}," \u0633\u064A\u062A\u0645 \u062A\u0637\u0628\u064A\u0642 \u0627\u0644\u0642\u064A\u0645 \u0627\u0644\u0645\u062F\u062E\u0644\u0629 \u0639\u0644\u0649 \u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629. \u0627\u062A\u0631\u0643 \u0627\u0644\u062D\u0642\u0644 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647. ",-1)),e("div",At,[e("div",null,[s(f,{for:"bulk_car_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629 ($)"}),s(S,{id:"bulk_car_price",type:"number",step:"0.01",modelValue:u.value.car_price,"onUpdate:modelValue":M[0]||(M[0]=_=>u.value.car_price=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"bulk_expenses",value:"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641 ($)"}),s(S,{id:"bulk_expenses",type:"number",step:"0.01",modelValue:u.value.expenses,"onUpdate:modelValue":M[1]||(M[1]=_=>u.value.expenses=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"bulk_additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),s(S,{id:"bulk_additional_expenses",type:"number",step:"0.01",modelValue:u.value.additional_expenses,"onUpdate:modelValue":M[2]||(M[2]=_=>u.value.additional_expenses=_),placeholder:"\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0625\u0630\u0627 \u0643\u0646\u062A \u0644\u0627 \u062A\u0631\u064A\u062F \u062A\u0639\u062F\u064A\u0644\u0647",class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:N(()=>[e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:k,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:w,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062D\u0641\u0638 \u0627\u0644\u062A\u0639\u062F\u064A\u0644\u0627\u062A ")])]),_:1},8,["show"]))}},Ot={class:"flex justify-between items-center"},Yt={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},qt={class:"max-w-9xl mx-auto sm:px-6 lg:px-8 p-6 dark:bg-gray-900"},Ht={class:"overflow-hidden shadow-sm sm:rounded-lg"},Rt={class:"mb-4 flex items-center justify-between"},zt={class:"flex items-center gap-4"},Gt={class:"flex items-center cursor-pointer"},Jt={class:"relative"},Kt=["checked"],Qt={key:0,class:"mb-6"},Wt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"},Xt={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},Zt={class:"flex items-center justify-between"},el={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},tl={class:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4"},ll={class:"flex items-center justify-between"},al={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},rl={class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},sl={class:"flex items-center justify-between"},ol={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},nl={class:"flex items-center justify-between"},dl={class:"text-2xl font-bold text-red-600 dark:text-red-400"},il={key:0,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700"},ul={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},cl={class:"text-sm text-gray-600 dark:text-gray-400"},pl={class:"text-lg font-bold text-gray-800 dark:text-gray-200"},gl={key:1,class:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800"},ml={class:"flex justify-between items-center mb-4"},bl={class:"text-lg font-bold dark:text-green-300"},yl={key:0,class:"text-center py-4"},xl={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},_l={key:2,class:"overflow-x-auto max-h-96 overflow-y-auto"},vl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},fl={class:"px-2 py-3 font-medium"},hl={class:"px-2 py-3"},kl={class:"px-2 py-3"},wl={class:"font-mono text-xs"},$l={key:0,class:"text-xs text-gray-500"},Vl={class:"px-2 py-3 font-bold"},Cl={class:"px-2 py-3"},Sl=["onClick"],Ul={key:2,class:"mt-4"},Il={key:0,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},jl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fl={class:"flex justify-between items-center mb-2"},Ml={key:0},Bl={key:1},El={key:0,class:"relative"},Nl={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},Tl={key:0},Dl={class:"md:col-span-2"},Pl={key:1,class:"text-center py-10"},Al={key:2,class:"overflow-x-auto shadow-md sm:rounded-lg"},Ll={class:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Ol={class:"flex items-center gap-2"},Yl={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},ql={key:0,class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 flex justify-between items-center"},Hl={class:"text-blue-700 dark:text-blue-300 font-medium"},Rl={class:"w-full text-sm text-right text-gray-500 dark:text-gray-200 dark:text-gray-400 text-center"},zl={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center"},Gl={class:"px-2 py-3 print:hidden"},Jl=["checked"],Kl={class:"px-2 py-3 print:hidden"},Ql=["checked","onChange"],Wl={class:"px-2 py-3"},Xl={class:"px-2 py-3 font-medium"},Zl={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},ea={class:"px-2 py-3"},ta={class:"px-2 py-3 font-mono text-xs"},la={class:"px-2 py-3"},aa={class:"px-2 py-3"},ra={class:"px-2 py-3"},sa={class:"px-2 py-3"},oa={class:"px-2 py-3"},na={class:"px-2 py-3"},da={class:"px-2 py-3"},ia={key:0,class:"mb-1"},ua={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},ca={class:"px-2 py-3 print:hidden"},pa=["onClick"],ga=["onClick"],ma={key:0,class:"bg-gray-100 dark:bg-gray-800"},ba={colspan:"13",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},ya={key:0},xa={key:1},_a={key:0,class:"bg-gray-100 dark:bg-gray-800 font-bold"},va={class:"px-2 py-3"},fa={class:"px-2 py-3"},ha={class:"px-2 py-3"},ka={class:"px-2 py-3"},wa={class:"px-2 py-3"},$a={key:3,class:"mb-6 mt-6"},Va={key:0,class:"text-center py-4"},Ca={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Sa={class:"flex justify-between items-start mb-3"},Ua={class:"font-bold text-lg text-gray-800 dark:text-gray-200"},Ia={class:"text-sm text-gray-500 dark:text-gray-400"},ja={class:"space-y-2 text-sm"},Fa={class:"flex justify-between"},Ma={class:"font-medium"},Ba={class:"flex justify-between"},Ea={class:"font-medium text-green-600"},Na={class:"border-t pt-2 mt-2 flex justify-between items-center font-bold text-lg"},Ta={class:"mt-3 pt-3 border-t"},Da={class:"flex gap-2"},Pa=["onClick"],Aa=["onClick"],La={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Oa={class:"space-y-4"},Ya={class:"flex justify-between items-center mb-2"},qa={key:0},Ha={key:1},Ra={key:0,class:"relative"},za={key:1,class:"space-y-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},Ga={key:0,class:"text-center py-4"},Ja={key:1,class:"text-center py-4 text-gray-500 dark:text-gray-400"},Ka={key:2,class:"max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-2"},Qa={class:"flex-1"},Wa={class:"font-medium"},Xa={class:"text-xs text-gray-500 dark:text-gray-400 mr-2"},Za={class:"text-xs text-blue-600 dark:text-blue-400"},er=["onClick","disabled"],tr={key:0},lr={class:"space-y-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3"},ar={class:"flex justify-between items-start mb-2"},rr={class:"font-medium"},sr={class:"text-xs text-gray-500 dark:text-gray-400"},or=["onClick"],nr={class:"grid grid-cols-2 gap-2 mt-2"},dr={class:"flex justify-end gap-2"},fr={__name:"InternalSales",props:{url:String,client_id:String,client:Object,clients:Array},setup(V){let y=Se();const U=V;let I=v(!1),u=v(!1),k=v([]),w=v({}),C=v(!1),M=v(!1),_=v([]),b=v(!1),g=v([]),d=v(!1),c=v(!1),x=v([]),A=v(!1),te=v(null),p=v({}),re=v(null),j=v([]),ue=v(!1),ye=v(!1),xe=v(!1),O=v(null),_e=v(!1),ve=v(!1),h=v({client_id:null,client_name:"",client_phone:"",cars:[],sale_date:"",showNewClientForm:!1}),D=v("");const E=ee(()=>{var a;return U.client_id||((a=U.client)==null?void 0:a.id)}),W=ee(()=>{const a=k.value,t={};a.forEach(L=>{var J;const T=((J=L.car)==null?void 0:J.car_type)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F";t[T]||(t[T]=0),t[T]++});const l=x.value.reduce((L,T)=>L+(T.remaining_debt>0?T.remaining_debt:0),0),m=w.value.total_sales||0,$=(w.value.total_expenses||0)+a.reduce((L,T)=>L+(parseFloat(T.additional_expenses)||0),0),q=w.value.total_profit||0;return{carTypes:Object.entries(t).map(([L,T])=>({type:L,count:T})),totalDebt:l,totalSales:m,totalExpenses:$,totalProfit:q,totalCarsSold:a.length}}),fe=ee(()=>_.value.length>0?_.value.map(a=>({value:a.id,text:`${a.car_type||""} ${a.year||""} - ${a.vin||a.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"}`,vin:a.vin||"",car_number:a.car_number||"",car_type:a.car_type||"",year:a.year||"",total_s:a.total_s||0,car_price:a.car_price||0})):[]),we=ee(()=>g.value.length>0?g.value.map(a=>({value:a.id,text:`${a.name||""}${a.phone?" - "+a.phone:""}`,name:a.name||"",phone:a.phone||""})):[]),le=ee(()=>{if(!D.value||D.value.trim()==="")return k.value;const a=D.value.toLowerCase().trim();return k.value.filter(t=>{var J,se,oe,Z,pe,Ce;const l=(((J=t.car)==null?void 0:J.vin)||"").toLowerCase(),m=(((se=t.car)==null?void 0:se.car_number)||"").toLowerCase(),$=(((oe=t.car)==null?void 0:oe.car_type)||"").toLowerCase(),q=(((Z=t.car)==null?void 0:Z.year)||"").toString().toLowerCase(),L=(((pe=t.client)==null?void 0:pe.name)||"").toLowerCase(),T=(((Ce=t.client)==null?void 0:Ce.phone)||"").toLowerCase();return l.includes(a)||m.includes(a)||$.includes(a)||q.includes(a)||L.includes(a)||T.includes(a)})});function Ie(){const a=fe.value.find(t=>t.value===p.value.car_id);if(a){p.value.car_price=0;const t=a.total_s;p.value.shipping=0;let l=t;if(!t||t===0){const m=_.value.find($=>$.id===p.value.car_id);m&&m.total_s&&(l=m.total_s)}p.value.expenses=l||0}}function ae(){const a=new Date,t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),m=String(a.getDate()).padStart(2,"0");return`${t}-${l}-${m}`}function je(a){if(!a)return"-";try{if(typeof a=="string"&&a.includes("T"))return a.split("T")[0];const t=new Date(a);if(isNaN(t.getTime()))return a;const l=t.getFullYear(),m=String(t.getMonth()+1).padStart(2,"0"),$=String(t.getDate()).padStart(2,"0");return`${l}-${m}-${$}`}catch{return a}}function F(a){return a==null?"0":(typeof a=="number"?a:parseFloat(a)||0).toFixed(2).replace(/\.00$/,"")}async function X(){if(!!E.value){b.value=!0,_.value=[];try{const a=await P.get("/api/getUnsoldCars",{params:{client_id:E.value}});a.data&&a.data.cars&&Array.isArray(a.data.cars)&&(_.value=a.data.cars)}catch(a){console.error("Error loading unsold cars:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{b.value=!1}}}async function Y(){if(!!E.value){M.value=!0;try{const a=await P.get("/api/getInternalSales",{params:{client_id:E.value}});k.value=a.data.sales||[],w.value=a.data.totals||{},C.value=a.data.has_internal_sales||!1,a.data.client&&(te.value=a.data.client)}catch(a){console.error("Error loading internal sales:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{M.value=!1}}}async function G(){A.value=!0;try{const a=await P.get("/api/getInternalSalesBuyers",{params:{client_id:E.value}});x.value=a.data.buyers||[]}catch(a){console.error("Error loading internal sales buyers:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0632\u0628\u0627\u0626\u0646",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{A.value=!1}}async function ce(){if(!!E.value){d.value=!0;try{const a=await P.get("/api/getAllClients",{params:{client_id:E.value}});a.data&&a.data.clients?g.value=a.data.clients:U.clients&&Array.isArray(U.clients)&&(g.value=U.clients)}catch(a){console.error("Error loading clients:",a),U.clients&&Array.isArray(U.clients)&&(g.value=U.clients)}finally{d.value=!1}}}async function Fe(){if(!!E.value)try{const a=await P.post("/api/toggleInternalSales",{client_id:E.value,has_internal_sales:!C.value});C.value=a.data.has_internal_sales,y.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:2e3,position:"bottom-right",rtl:!0}),C.value&&(Y(),X())}catch(a){console.error("Error toggling internal sales:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u062D\u0627\u0644\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Me(a=null){if(a&&a.id){const t={id:a.id,car_type:a.car_type,year:a.year,vin:a.vin,car_number:a.car_number,total_s:a.total_s||0,car_price:a.car_price||0};_.value=[t],await ce();const l=fe.value.find(m=>m.value===a.id);p.value={client_id:E.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:(l==null?void 0:l.total_s)||a.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:ae()},c.value=!1,I.value=!0;return}if(!a&&_.value.length===0&&await X(),await ce(),a&&a.id){const t=_.value.find(l=>l.id===a.id)||a;p.value={client_id:E.value,client_name:"",client_phone:"",car_id:a.id,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:t.total_s||0,additional_expenses:0,note:"",payment_note:"",sale_date:ae()},c.value=!1,I.value=!0;return}p.value={client_id:E.value,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:ae()},c.value=!1,I.value=!0}function he(){I.value=!1,p.value={client_id:null,client_name:"",client_phone:"",car_id:null,car_price:0,shipping:0,sale_price:0,paid_amount:0,expenses:0,additional_expenses:0,note:"",payment_note:"",sale_date:ae()},_.value=[],c.value=!1}function Be(a){re.value=a,u.value=!0}function Ee(a){p.value=a,Te()}async function Ne(){var l,m;const a=p.value.client_id&&p.value.client_id!==""&&p.value.client_id!==null&&p.value.client_id!==void 0;if(!c.value&&!a){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(c.value&&!p.value.client_name){y.error("\u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!p.value.car_id){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629",{timeout:2e3,position:"bottom-right",rtl:!0});return}const t={...p.value};c.value?(t.client_id=null,t.client_name=t.client_name||"",t.client_phone=t.client_phone||""):(t.client_id=parseInt(t.client_id)||null,t.client_name=null,t.client_phone=null);try{await P.post("/api/addInternalSale",t),y.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),he(),Y(),G(),X()}catch($){console.error("Error adding internal sale:",$),y.error(((m=(l=$.response)==null?void 0:l.data)==null?void 0:m.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function Te(){try{await P.post("/api/updateInternalSale",p.value),y.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),u.value=!1,Y(),G()}catch(a){console.error("Error updating internal sale:",a),y.error("\u0641\u0634\u0644 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}async function De(a){if(!!confirm("\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629\u061F"))try{await P.post("/api/deleteInternalSale",{id:a.id}),y.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),Y(),G(),X()}catch(t){console.error("Error deleting internal sale:",t),y.error("\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u0645\u0628\u064A\u0639\u0629 \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Pe(a){const t=j.value.indexOf(a);t>-1?j.value.splice(t,1):j.value.push(a)}function Ae(){const a=le.value.map(l=>l.id);a.length>0&&a.every(l=>j.value.includes(l))?j.value=j.value.filter(l=>!a.includes(l)):a.forEach(l=>{j.value.includes(l)||j.value.push(l)})}function Le(){if(j.value.length===0){y.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}ue.value=!0}function $e(){ue.value=!1}async function Oe(a){var l,m;if(j.value.length===0){y.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0628\u064A\u0639\u0627\u062A \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(!(a.car_price!==null||a.expenses!==null||a.additional_expenses!==null)){y.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0642\u064A\u0645\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0644\u0644\u062A\u0639\u062F\u064A\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const $={sale_ids:j.value,car_price:a.car_price,expenses:a.expenses,additional_expenses:a.additional_expenses};await P.post("/api/bulkUpdateInternalSales",$),y.success(`\u062A\u0645 \u062A\u0639\u062F\u064A\u0644 ${j.value.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),$e(),j.value=[],Y(),G()}catch($){console.error("Error bulk updating internal sales:",$),y.error(((m=(l=$.response)==null?void 0:l.data)==null?void 0:m.error)||"\u0641\u0634\u0644 \u0627\u0644\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u062C\u0645\u0639",{timeout:3e3,position:"bottom-right",rtl:!0})}}function Ye(a){if(a.remaining_debt<=0){y.error("\u0644\u0627 \u064A\u0648\u062C\u062F \u062F\u064A\u0646 \u0644\u0647\u0630\u0627 \u0627\u0644\u0632\u0628\u0648\u0646",{timeout:2e3,position:"bottom-right",rtl:!0});return}O.value=a,ye.value=!0}function Ve(){ye.value=!1,O.value=null}async function qe(a){var m,$;if(!O.value)return;const t=typeof a=="object"?a.amount:a,l=typeof a=="object"&&a.note||"";if(!t||t<=0){y.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0635\u062D\u064A\u062D",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(t>O.value.remaining_debt){y.error("\u0627\u0644\u0645\u0628\u0644\u063A \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0645\u062A\u0628\u0642\u064A",{timeout:2e3,position:"bottom-right",rtl:!0});return}_e.value=!0;try{await P.post("/api/addPaymentToBuyer",{buyer_id:O.value.id,merchant_id:E.value,amount:t,note:l}),y.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0}),Ve(),Y(),G()}catch(q){console.error("Error adding payment:",q),y.error((($=(m=q.response)==null?void 0:m.data)==null?void 0:$.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062F\u0641\u0639\u0629",{timeout:3e3,position:"bottom-right",rtl:!0})}finally{_e.value=!1}}function He(a){O.value=a,xe.value=!0}function Re(){xe.value=!1,O.value=null}function ze(){Y(),G()}function Ge(){_.value.length===0&&X(),ce(),h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:ae()},ve.value=!0}function ke(){ve.value=!1,h.value={client_id:null,client_name:"",client_phone:"",cars:[],sale_date:ae()}}function Je(a){h.value.cars.findIndex(l=>l.car_id===a.id)===-1&&h.value.cars.push({car_id:a.id,car_type:a.car_type,year:a.year,vin:a.vin||a.car_number,total_s:a.total_s||0,sale_price:0,paid_amount:0,expenses:a.total_s||0,additional_expenses:0})}function Ke(a){h.value.cars.splice(a,1)}async function Qe(){var a,t;if(!h.value.client_id&&!h.value.client_name){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",{timeout:2e3,position:"bottom-right",rtl:!0});return}if(h.value.cars.length===0){y.error("\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0633\u064A\u0627\u0631\u0629 \u0648\u0627\u062D\u062F\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644",{timeout:2e3,position:"bottom-right",rtl:!0});return}try{const l={client_id:h.value.client_id,client_name:h.value.client_name||null,client_phone:h.value.client_phone||null,cars:h.value.cars,sale_date:h.value.sale_date};await P.post("/api/addBulkInternalSale",l),y.success(`\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 ${h.value.cars.length} \u0645\u0628\u064A\u0639\u0629 \u0628\u0646\u062C\u0627\u062D`,{timeout:2e3,position:"bottom-right",rtl:!0}),ke(),Y(),G(),X()}catch(l){console.error("Error adding bulk sale:",l),y.error(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.error)||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",{timeout:3e3,position:"bottom-right",rtl:!0})}}return We(()=>{E.value&&(Y(),G(),X(),ce())}),(a,t)=>(n(),i(H,null,[s(r(Xe),{title:"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629"}),s(et,null,{header:N(()=>{var l;return[e("div",Ot,[e("h2",Yt," \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 - "+o(((l=U.client)==null?void 0:l.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),s(r(Ze),{href:`/showClients/${E.value}`,class:"text-blue-600 hover:text-blue-800 dark:text-blue-400"},{default:N(()=>[...t[23]||(t[23]=[ne(" \u0627\u0644\u0639\u0648\u062F\u0629 \u0625\u0644\u0649 \u0635\u0641\u062D\u0629 \u0627\u0644\u062A\u0627\u062C\u0631 ",-1)])]),_:1},8,["href"])])]}),default:N(()=>[e("div",qt,[e("div",Ht,[e("div",Rt,[t[26]||(t[26]=e("h2",{class:"text-xl font-bold dark:text-gray-400"},"\u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",zt,[e("label",Gt,[t[25]||(t[25]=e("span",{class:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300"},"\u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Jt,[e("input",{type:"checkbox",class:"sr-only peer",checked:r(C),onChange:Fe},null,40,Kt),t[24]||(t[24]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])])])]),r(C)&&r(k).length>0?(n(),i("div",Qt,[t[36]||(t[36]=e("h3",{class:"text-lg font-bold mb-4 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("div",Wt,[e("div",Xt,[e("div",Zt,[e("div",null,[t[27]||(t[27]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A",-1)),e("p",el,o(F(W.value.totalSales))+" $",1)]),t[28]||(t[28]=e("div",{class:"text-blue-500 text-3xl"},"\u{1F4B0}",-1))])]),e("div",tl,[e("div",ll,[e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),e("p",al,o(F(W.value.totalExpenses))+" $",1)]),t[30]||(t[30]=e("div",{class:"text-orange-500 text-3xl"},"\u{1F4CA}",-1))])]),e("div",rl,[e("div",sl,[e("div",null,[t[31]||(t[31]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0631\u0628\u062D",-1)),e("p",{class:K(["text-2xl font-bold",W.value.totalProfit>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},o(F(W.value.totalProfit))+" $ ",3)]),t[32]||(t[32]=e("div",{class:"text-green-500 text-3xl"},"\u{1F4C8}",-1))])]),e("div",ol,[e("div",nl,[e("div",null,[t[33]||(t[33]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"\u0627\u0644\u062F\u064A\u0646 \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A",-1)),e("p",dl,o(F(W.value.totalDebt))+" $",1)]),t[34]||(t[34]=e("div",{class:"text-red-500 text-3xl"},"\u26A0\uFE0F",-1))])])]),W.value.carTypes.length>0?(n(),i("div",il,[t[35]||(t[35]=e("h4",{class:"text-md font-bold mb-3 dark:text-gray-300"},"\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u0628\u0627\u0639\u0629",-1)),e("div",ul,[(n(!0),i(H,null,Q(W.value.carTypes,l=>(n(),i("div",{key:l.type,class:"bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600"},[e("p",cl,o(l.type),1),e("p",pl,o(l.count)+" \u0633\u064A\u0627\u0631\u0629",1)]))),128))])])):B("",!0)])):B("",!0),r(C)&&r(_).length>0?(n(),i("div",gl,[e("div",ml,[e("h3",bl,"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ("+o(r(_).length)+")",1),e("button",{onClick:t[0]||(t[0]=l=>Ge()),class:"px-3 py-1 text-sm text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0628\u064A\u0639 \u0645\u062C\u0645\u0639 ")]),r(b)?(n(),i("div",yl,[...t[37]||(t[37]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"},null,-1)])])):r(_).length===0?(n(),i("div",xl," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 \u062D\u0627\u0644\u064A\u0627\u064B ")):(n(),i("div",_l,[e("table",vl,[t[39]||(t[39]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 text-center sticky top-0"},[e("tr",null,[e("th",{class:"px-2 py-3"},"\u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u0646\u0629"),e("th",{class:"px-2 py-3"},"\u0631\u0642\u0645 \u0627\u0644\u0634\u0627\u0635\u064A / \u0627\u0644\u0633\u064A\u0627\u0631\u0629"),e("th",{class:"px-2 py-3"},"\u0627\u0644\u062A\u0643\u0644\u0641\u0629 (Total S)"),e("th",{class:"px-2 py-3"},"\u0625\u062C\u0631\u0627\u0621")])],-1)),e("tbody",null,[(n(!0),i(H,null,Q(r(_),l=>(n(),i("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",fl,o(l.car_type),1),e("td",hl,o(l.year),1),e("td",kl,[e("div",wl,o(l.vin),1),l.car_number?(n(),i("div",$l,o(l.car_number),1)):B("",!0)]),e("td",Vl,o(F(l.total_s))+" $",1),e("td",Cl,[e("button",{onClick:m=>Me(l),class:"px-3 py-1 text-white bg-blue-600 rounded hover:bg-blue-700 text-xs flex items-center justify-center mx-auto gap-1"},[...t[38]||(t[38]=[e("span",{class:"text-lg"},"+",-1),ne(" \u0628\u064A\u0639 ",-1)])],8,Sl)])]))),128))])])]))])):B("",!0),r(C)?(n(),i("div",Ul,[r(I)?(n(),i("div",Il,[e("div",{class:"flex justify-between items-center mb-4"},[t[40]||(t[40]=e("h3",{class:"text-lg font-bold dark:text-gray-100"},"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u064A\u0639\u0629 \u062F\u0627\u062E\u0644\u064A\u0629",-1)),e("button",{onClick:he,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," \u2715 ")]),e("div",jl,[e("div",null,[e("div",Fl,[s(f,{for:"client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[1]||(t[1]=l=>ge(c)?c.value=!r(c):c=!r(c)),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors duration-200 flex items-center gap-1"},[r(c)?(n(),i("span",Bl,[...t[42]||(t[42]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),ne(" \u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F ",-1)])])):(n(),i("span",Ml,[...t[41]||(t[41]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ne(" \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F ",-1)])]))])]),r(c)?(n(),i("div",Nl,[e("div",null,[s(f,{for:"client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),s(S,{id:"client_name",modelValue:r(p).client_name,"onUpdate:modelValue":t[3]||(t[3]=l=>r(p).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[s(f,{for:"client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),s(S,{id:"client_phone",modelValue:r(p).client_phone,"onUpdate:modelValue":t[4]||(t[4]=l=>r(p).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(n(),i("div",El,[s(r(me),{modelValue:r(p).client_id,"onUpdate:modelValue":t[2]||(t[2]=l=>r(p).client_id=l),list:we.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":r(d),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[s(f,{for:"car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0629"}),s(r(me),{modelValue:r(p).car_id,"onUpdate:modelValue":t[5]||(t[5]=l=>r(p).car_id=l),list:fe.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0633\u064A\u0627\u0631\u0629 \u0628\u0627\u0644\u0634\u0627\u0646\u0635 (VIN) \u0623\u0648 \u0627\u0644\u0643\u0627\u062A\u064A (\u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629)...","is-disabled":r(b),onChange:Ie,class:"dark:bg-gray-700 dark:text-gray-100"},null,8,["modelValue","list","is-disabled"])]),e("div",null,[R(e("input",{type:"hidden","onUpdate:modelValue":t[6]||(t[6]=l=>r(p).car_price=l)},null,512),[[z,r(p).car_price]])]),R(e("input",{type:"hidden","onUpdate:modelValue":t[7]||(t[7]=l=>r(p).shipping=l)},null,512),[[z,r(p).shipping]]),e("div",null,[s(f,{for:"sale_price",value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)"}),s(S,{id:"sale_price",type:"number",step:"0.01",modelValue:r(p).sale_price,"onUpdate:modelValue":t[8]||(t[8]=l=>r(p).sale_price=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"paid_amount",value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)"}),s(S,{id:"paid_amount",type:"number",step:"0.01",modelValue:r(p).paid_amount,"onUpdate:modelValue":t[9]||(t[9]=l=>r(p).paid_amount=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),r(p).paid_amount>0?(n(),i("div",Tl,[s(f,{for:"payment_note",value:"\u0645\u0644\u0627\u062D\u0638\u0629 \u0627\u0644\u062F\u0641\u0639\u0629 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"}),R(e("textarea",{id:"payment_note","onUpdate:modelValue":t[10]||(t[10]=l=>r(p).payment_note=l),rows:"2",placeholder:"\u0623\u062F\u062E\u0644 \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0644\u062F\u0641\u0639\u0629 \u0627\u0644\u0623\u0648\u0644\u0649 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[z,r(p).payment_note]])])):B("",!0),R(e("input",{type:"hidden","onUpdate:modelValue":t[11]||(t[11]=l=>r(p).expenses=l)},null,512),[[z,r(p).expenses]]),e("div",null,[s(f,{for:"additional_expenses",value:"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629 ($)"}),s(S,{id:"additional_expenses",type:"number",step:"0.01",modelValue:r(p).additional_expenses,"onUpdate:modelValue":t[12]||(t[12]=l=>r(p).additional_expenses=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",null,[s(f,{for:"sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),s(S,{id:"sale_date",type:"date",modelValue:r(p).sale_date,"onUpdate:modelValue":t[13]||(t[13]=l=>r(p).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])]),e("div",Dl,[s(f,{for:"note",value:"\u0645\u0644\u0627\u062D\u0638\u0627\u062A"}),R(e("textarea",{id:"note","onUpdate:modelValue":t[14]||(t[14]=l=>r(p).note=l),rows:"3",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},null,512),[[z,r(p).note]])])]),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{onClick:he,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:Ne,class:"px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800"}," \u0625\u0636\u0627\u0641\u0629 ")])])):B("",!0),t[60]||(t[60]=e("div",{class:"mb-4 flex justify-end"},null,-1)),r(M)?(n(),i("div",Pl,[...t[43]||(t[43]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A...",-1)])])):(n(),i("div",Al,[e("div",Ll,[e("div",Ol,[s(f,{for:"search_sale",value:"\u0628\u062D\u062B \u0639\u0646 \u0628\u064A\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629:",class:"!mb-0"}),s(S,{id:"search_sale",modelValue:r(D),"onUpdate:modelValue":t[15]||(t[15]=l=>ge(D)?D.value=l:D=l),type:"text",placeholder:"\u0627\u0628\u062D\u062B \u0628\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)\u060C \u0631\u0642\u0645 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0646\u0648\u0639 \u0627\u0644\u0633\u064A\u0627\u0631\u0629\u060C \u0627\u0633\u0645 \u0627\u0644\u0632\u0628\u0648\u0646...",class:"flex-1"},null,8,["modelValue"]),r(D)?(n(),i("button",{key:0,onClick:t[16]||(t[16]=l=>ge(D)?D.value="":D=""),class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}," \u2715 ")):B("",!0)]),r(D)?(n(),i("p",Yl," \u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 "+o(le.value.length)+" \u0645\u0646 "+o(r(k).length)+" \u0645\u0628\u064A\u0639\u0629 ",1)):B("",!0)]),r(j).length>0?(n(),i("div",ql,[e("span",Hl," \u062A\u0645 \u0627\u062E\u062A\u064A\u0627\u0631 "+o(r(j).length)+" \u0645\u0628\u064A\u0639\u0629 ",1),e("button",{onClick:Le,class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}," \u062A\u0639\u062F\u064A\u0644 \u0645\u062C\u0645\u0639 ")])):B("",!0),e("table",Rl,[e("thead",zl,[e("tr",null,[e("th",Gl,[e("input",{type:"checkbox",checked:r(j).length===le.value.length&&le.value.length>0,onChange:Ae,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,Jl)]),t[44]||(t[44]=e("th",{class:"px-2 py-3"},"#",-1)),t[45]||(t[45]=e("th",{class:"px-2 py-3"},"\u0627\u0633\u0645 \u0627\u0644\u0632\u0628\u0648\u0646 \u0627\u0644\u0645\u0634\u062A\u0631\u064A",-1)),t[46]||(t[46]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[47]||(t[47]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0634\u0627\u0646\u0635\u064A (VIN)",-1)),t[48]||(t[48]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0633\u064A\u0627\u0631\u0629",-1)),t[49]||(t[49]=e("th",{class:"px-2 py-3"},"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639",-1)),t[50]||(t[50]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639",-1)),t[51]||(t[51]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0645\u0635\u0627\u0631\u064A\u0641",-1)),t[52]||(t[52]=e("th",{class:"px-2 py-3"},"\u0645\u0635\u0627\u0631\u064A\u0641 \u0625\u0636\u0627\u0641\u064A\u0629",-1)),t[53]||(t[53]=e("th",{class:"px-2 py-3"},"\u0627\u0644\u0631\u0628\u062D",-1)),t[54]||(t[54]=e("th",{class:"px-2 py-3"},"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639",-1)),t[55]||(t[55]=e("th",{class:"px-2 py-3"},"\u0645\u0644\u0627\u062D\u0638\u0627\u062A",-1)),t[56]||(t[56]=e("th",{class:"px-2 py-3 print:hidden"},"\u062A\u0646\u0641\u064A\u0630",-1))])]),e("tbody",null,[(n(!0),i(H,null,Q(le.value,(l,m)=>{var $,q,L,T,J,se,oe;return n(),i("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",Kl,[e("input",{type:"checkbox",checked:r(j).includes(l.id),onChange:Z=>Pe(l.id),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,Ql)]),e("td",Wl,o(m+1),1),e("td",Xl,[e("div",null,o((($=l.client)==null?void 0:$.name)||"\u063A\u064A\u0631 \u0645\u062D\u062F\u062F"),1),(q=l.client)!=null&&q.phone?(n(),i("div",Zl,o((L=l.client)==null?void 0:L.phone),1)):B("",!0)]),e("td",ea,o((T=l.car)==null?void 0:T.car_type)+" "+o((J=l.car)==null?void 0:J.year),1),e("td",ta,o(((se=l.car)==null?void 0:se.vin)||((oe=l.car)==null?void 0:oe.car_number)||"-"),1),e("td",la,o(F(l.car_price))+" $",1),e("td",aa,o(F(l.sale_price))+" $",1),e("td",ra,o(F(l.paid_amount))+" $",1),e("td",sa,o(F(l.expenses))+" $",1),e("td",oa,o(F(l.additional_expenses))+" $",1),e("td",{class:K(["px-2 py-3 font-bold",(parseFloat(l.profit)||0)>=0?"text-green-600":"text-red-600"])},o(F(l.profit))+" $ ",3),e("td",na,o(je(l.sale_date||l.created_at)),1),e("td",da,[l.note?(n(),i("div",ia,o(l.note),1)):B("",!0),l.payment_notes&&l.payment_notes.length>0?(n(),i("div",ua,[(n(!0),i(H,null,Q(l.payment_notes,(Z,pe)=>(n(),i("div",{key:pe,class:"mt-1"},[t[57]||(t[57]=e("span",{class:"font-semibold"},"\u062F\u0641\u0639\u0629:",-1)),ne(" "+o(Z),1)]))),128))])):B("",!0)]),e("td",ca,[e("button",{onClick:Z=>Be(l),class:"px-2 py-1 text-white bg-blue-500 rounded hover:bg-blue-600 mr-1"},[s(tt,{class:"w-4 h-4 inline"})],8,pa),e("button",{onClick:Z=>De(l),class:"px-2 py-1 text-white bg-red-500 rounded hover:bg-red-600"},[s(Ue,{class:"w-4 h-4 inline"})],8,ga)])])}),128)),le.value.length===0?(n(),i("tr",ma,[e("td",ba,[r(D)?(n(),i("span",ya,'\u0644\u0627 \u062A\u0648\u062C\u062F \u0646\u062A\u0627\u0626\u062C \u0644\u0644\u0628\u062D\u062B "'+o(r(D))+'"',1)):(n(),i("span",xa,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u0628\u064A\u0639\u0627\u062A \u062F\u0627\u062E\u0644\u064A\u0629"))])])):B("",!0)]),r(k).length>0?(n(),i("tfoot",_a,[e("tr",null,[t[58]||(t[58]=e("td",{colspan:"3",class:"px-2 py-3 text-left"},"\u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A:",-1)),e("td",va,o(F(r(k).reduce((l,m)=>l+(parseFloat(m.car_price)||0),0)))+" $",1),e("td",fa,o(F(r(w).total_sales))+" $",1),e("td",ha,o(F(r(w).total_paid))+" $",1),e("td",ka,o(F(r(w).total_expenses))+" $",1),e("td",wa,o(F(r(k).reduce((l,m)=>l+(parseFloat(m.additional_expenses)||0),0)))+" $",1),e("td",{class:K(["px-2 py-3",(parseFloat(r(w).total_profit)||0)>=0?"text-green-600":"text-red-600"])},o(F(r(w).total_profit))+" $ ",3),t[59]||(t[59]=e("td",{colspan:"3"},null,-1))])])):B("",!0)])]))])):B("",!0),r(C)&&r(x).length>0?(n(),i("div",$a,[t[64]||(t[64]=e("h3",{class:"text-lg font-bold mb-4 dark:text-blue-300"},"\u0627\u0644\u0632\u0628\u0627\u0626\u0646 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0648\u0646 \u0641\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629",-1)),r(A)?(n(),i("div",Va,[...t[61]||(t[61]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(n(),i("div",Ca,[(n(!0),i(H,null,Q(r(x),l=>(n(),i("div",{key:l.id,class:K(["p-4 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-md",l.remaining_debt>0?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"])},[e("div",Sa,[e("div",null,[e("h4",Ua,o(l.name),1),e("p",Ia,o(l.phone),1)]),e("div",{class:K(["text-center bg-white dark:bg-gray-800 rounded-full px-3 py-1 text-xs font-bold border",l.remaining_debt>0?"text-red-600 border-red-100":"text-green-600 border-green-100"])},o(l.sales_count)+" \u0633\u064A\u0627\u0631\u0629 ",3)]),e("div",ja,[e("div",Fa,[t[62]||(t[62]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A:",-1)),e("span",Ma,o(F(l.total_sales))+" $",1)]),e("div",Ba,[t[63]||(t[63]=e("span",{class:"text-gray-600 dark:text-gray-400"},"\u0627\u0644\u0645\u062F\u0641\u0648\u0639:",-1)),e("span",Ea,o(F(l.total_paid))+" $",1)]),e("div",Na,[e("span",{class:K(l.remaining_debt>0?"text-red-600":"text-green-600")},o(l.remaining_debt>0?"\u0627\u0644\u0645\u062A\u0628\u0642\u064A (\u062F\u064A\u0646):":"\u0648\u0627\u0635\u0644:"),3),e("span",{class:K(l.remaining_debt>0?"text-red-600":"text-green-600")},o(F(Math.abs(l.remaining_debt)))+" $ ",3)])]),e("div",Ta,[e("div",Da,[l.remaining_debt>0?(n(),i("button",{key:0,onClick:m=>Ye(l),class:"flex-1 px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 font-medium text-sm"}," \u0625\u0636\u0627\u0641\u0629 \u062F\u0641\u0639 ",8,Pa)):B("",!0),e("button",{onClick:m=>He(l),class:"flex-1 px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 font-medium text-sm"}," \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u062F\u0641\u0639 ",8,Aa)])])],2))),128))]))])):r(C)?B("",!0):(n(),i("div",La," \u064A\u062C\u0628 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A \u0627\u0644\u062F\u0627\u062E\u0644\u064A\u0629 \u0623\u0648\u0644\u0627\u064B "))])]),s(at,{show:r(u),sale:r(re),clients:r(g).map(l=>({value:l.id,text:`${l.name||""}${l.phone?" - "+l.phone:""}`,name:l.name||"",phone:l.phone||""})),onClose:t[17]||(t[17]=l=>ge(u)?u.value=!1:u=!1),onUpdate:Ee},null,8,["show","sale","clients"]),s(Lt,{show:r(ue),"selected-count":r(j).length,onClose:$e,onConfirm:Oe},null,8,["show","selected-count"]),s(ht,{show:r(ye),buyer:r(O),"merchant-id":E.value,"is-loading":r(_e),onClose:Ve,onConfirm:qe},null,8,["show","buyer","merchant-id","is-loading"]),s(Dt,{show:r(xe),buyer:r(O),"merchant-id":E.value,onClose:Re,onRefresh:ze},null,8,["show","buyer","merchant-id"]),s(ie,{show:r(ve),onClose:ke},{header:N(()=>[...t[65]||(t[65]=[e("h2",{class:"text-xl font-bold dark:text-gray-100"},"\u0628\u064A\u0639 \u0645\u062C\u0645\u0639 - \u0628\u064A\u0639 \u0639\u062F\u0629 \u0633\u064A\u0627\u0631\u0627\u062A \u0644\u0646\u0641\u0633 \u0627\u0644\u0632\u0628\u0648\u0646",-1)])]),body:N(()=>[e("div",Oa,[e("div",null,[e("div",Ya,[s(f,{for:"bulk_client_select",value:"\u0627\u0644\u0639\u0645\u064A\u0644",class:"!mb-0"}),e("button",{type:"button",onClick:t[18]||(t[18]=l=>r(h).showNewClientForm=!r(h).showNewClientForm),class:"text-xs font-bold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},[r(h).showNewClientForm?(n(),i("span",Ha,"\u0627\u062E\u062A\u064A\u0627\u0631 \u0639\u0645\u064A\u0644 \u0645\u0648\u062C\u0648\u062F")):(n(),i("span",qa,"+ \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F"))])]),r(h).showNewClientForm?(n(),i("div",za,[e("div",null,[s(f,{for:"bulk_client_name",value:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u062C\u062F\u064A\u062F",class:"text-xs mb-1"}),s(S,{id:"bulk_client_name",modelValue:r(h).client_name,"onUpdate:modelValue":t[20]||(t[20]=l=>r(h).client_name=l),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644",class:"block w-full text-sm",required:""},null,8,["modelValue"])]),e("div",null,[s(f,{for:"bulk_client_phone",value:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",class:"text-xs mb-1"}),s(S,{id:"bulk_client_phone",modelValue:r(h).client_phone,"onUpdate:modelValue":t[21]||(t[21]=l=>r(h).client_phone=l),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",class:"block w-full text-sm"},null,8,["modelValue"])])])):(n(),i("div",Ra,[s(r(me),{modelValue:r(h).client_id,"onUpdate:modelValue":t[19]||(t[19]=l=>r(h).client_id=l),list:we.value,"option-value":"value","option-text":"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641...","is-disabled":r(d),class:"dark:bg-gray-700 dark:text-gray-100 w-full"},null,8,["modelValue","list","is-disabled"])]))]),e("div",null,[s(f,{for:"bulk_car_select",value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0627\u062D\u0629"}),r(b)?(n(),i("div",Ga,[...t[66]||(t[66]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):r(_).length===0?(n(),i("div",Ja," \u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u064A\u0627\u0631\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0628\u064A\u0639 ")):(n(),i("div",Ka,[(n(!0),i(H,null,Q(r(_),l=>(n(),i("div",{key:l.id,class:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded mb-1"},[e("div",Qa,[e("span",Wa,o(l.car_type)+" "+o(l.year),1),e("span",Xa,"- "+o(l.vin||l.car_number||"\u0628\u062F\u0648\u0646 \u0631\u0642\u0645"),1),e("span",Za,"("+o(F(l.total_s))+" $)",1)]),e("button",{onClick:m=>Je(l),disabled:r(h).cars.some(m=>m.car_id===l.id),class:"px-3 py-1 text-xs text-white bg-green-600 rounded hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},o(r(h).cars.some(m=>m.car_id===l.id)?"\u0645\u0636\u0627\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629"),9,er)]))),128))]))]),r(h).cars.length>0?(n(),i("div",tr,[s(f,{value:"\u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062E\u062A\u0627\u0631\u0629"}),e("div",lr,[(n(!0),i(H,null,Q(r(h).cars,(l,m)=>(n(),i("div",{key:m,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700"},[e("div",ar,[e("div",null,[e("p",rr,o(l.car_type)+" "+o(l.year),1),e("p",sr,o(l.vin),1)]),e("button",{onClick:$=>Ke(m),class:"text-red-600 hover:text-red-800 text-sm"}," \u2715 \u062D\u0630\u0641 ",8,or)]),e("div",nr,[e("div",null,[s(f,{for:`sale_price_${m}`,value:"\u0633\u0639\u0631 \u0627\u0644\u0628\u064A\u0639 ($)",class:"text-xs"},null,8,["for"]),s(S,{id:`sale_price_${m}`,type:"number",step:"0.01",modelValue:l.sale_price,"onUpdate:modelValue":$=>l.sale_price=$,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])]),e("div",null,[s(f,{for:`paid_amount_${m}`,value:"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062F\u0641\u0648\u0639 ($)",class:"text-xs"},null,8,["for"]),s(S,{id:`paid_amount_${m}`,type:"number",step:"0.01",modelValue:l.paid_amount,"onUpdate:modelValue":$=>l.paid_amount=$,class:"mt-1 block w-full text-sm"},null,8,["id","modelValue","onUpdate:modelValue"])])])]))),128))])])):B("",!0),e("div",null,[s(f,{for:"bulk_sale_date",value:"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0628\u064A\u0639"}),s(S,{id:"bulk_sale_date",type:"date",modelValue:r(h).sale_date,"onUpdate:modelValue":t[22]||(t[22]=l=>r(h).sale_date=l),class:"mt-1 block w-full"},null,8,["modelValue"])])])]),footer:N(()=>[e("div",dr,[e("button",{onClick:ke,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600"}," \u0625\u0644\u063A\u0627\u0621 "),e("button",{onClick:Qe,class:"px-4 py-2 text-white bg-purple-600 rounded hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800"}," \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0628\u064A\u0639\u0627\u062A ("+o(r(h).cars.length)+") ",1)])]),_:1},8,["show"])]),_:1})],64))}};export{fr as default};
