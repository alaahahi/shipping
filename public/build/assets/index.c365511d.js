import{A as H,u as O,r as d,a as k,g as i,q as a,s as h,w as x,F as N,o as _,H as W,b as t,e as Y,v as z,L as G,f as J,h as K,t as f,i as Q,c as X}from"./app.2f81e609.js";import{_ as Z}from"./AuthenticatedLayout.e546d018.js";import{_ as q}from"./TextInput.8ea6631e.js";import{p as ee}from"./print.44fd998a.js";import{e as te}from"./edit.a7762cba.js";import{t as oe}from"./trash.1102bf38.js";import{_ as se}from"./ModalShowDamageReport.d77bbb74.js";import{M as ae}from"./ModalDelCar.64767c17.js";import{W as re}from"./v3-infinite-loading.es.df8353a7.js";/* empty css              */import{d as le}from"./debounce.d8f25e4e.js";import{a as $}from"./index.08479f1f.js";import"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                                    */const ne={class:"py-2"},de={class:"max-w-9xl mx-auto sm:px-6 lg:px-8"},ie={class:"bg-white overflow-hidden shadow-sm"},pe={class:"p-6 dark:bg-gray-900"},me={class:"flex flex-col"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 lg:gap-3 items-end"},ue={class:"md:col-span-2"},ge={class:"flex items-center max-w-5xl"},xe={class:"relative w-full"},fe={class:"flex gap-2"},ye={class:"py-2"},be={class:"max-w-9xl mx-auto sm:px-6 lg:px-8"},he={class:"bg-white overflow-hidden shadow-sm"},_e={class:"p-6 dark:bg-gray-900"},ve={class:"overflow-x-auto"},we={class:"w-full text-sm text-left text-gray-500 dark:text-gray-400"},ke={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},De={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Re={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Ce={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Ie={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Ve={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},Me={class:"px-3 py-2 sm:px-4 sm:py-2 text-center"},$e=["onClick"],Te=["onClick"],Ae=["onClick"],Ge={__name:"index",props:{owner_id:Number},setup(Ne){H();const y=O();let p=d(!1),m=d(!1),D=d({driver_name:"",cmr_number:"",cars_count:0,total_damage:0,cars_info:[],created:V()}),T=d({}),v=d([]),c=d(""),u=d(""),g=d(""),R=d(0),C=1,A=d(0);const I=()=>{C=1,v.value=[],R.value+=1},B=async o=>{var e,s,n,b;try{const r={limit:100,page:C};g.value&&(r.q=g.value),c.value&&(r.from=c.value),u.value&&(r.to=u.value),console.log("Request params:",r);const M=await $.get("/api/getIndexDamageReport",{params:r});console.log("API Response:",M.data),console.log("Response status:",M.status);const l=M.data;if(l.error){console.error("API Error:",l.error),y.error("\u062D\u062F\u062B \u062E\u0637\u0623: "+l.error,{timeout:3e3,position:"bottom-right",rtl:!0}),o.complete();return}A.value=l.total||0,console.log("Total reports:",A.value),console.log("Data array length:",((e=l.data)==null?void 0:e.length)||0),l.data&&Array.isArray(l.data)&&l.data.length>0?(console.log("Adding reports:",l.data.length),l.data.length<100?(v.value.push(...l.data),o.complete()):(v.value.push(...l.data),o.loaded()),C++):(console.log("No data found in response"),console.log("Response structure:",Object.keys(l)),o.complete())}catch(r){console.error("Error fetching reports:",r),console.error("Error response:",(s=r.response)==null?void 0:s.data),y.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062C\u0644\u0628 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A: "+(((b=(n=r.response)==null?void 0:n.data)==null?void 0:b.error)||r.message),{timeout:3e3,position:"bottom-right",rtl:!0}),o.complete()}};function V(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${n}`}function E(o){return o?o.includes("T")?o.split("T")[0]:o:""}function P(o=null){o?D.value={id:o.id,driver_name:o.driver_name||"",cmr_number:o.cmr_number||"",cars_count:o.cars_count||0,total_damage:o.total_damage||0,cars_info:o.cars_info||[],created:o.created||V()}:D.value={driver_name:"",cmr_number:"",cars_count:0,total_damage:0,cars_info:[],created:V()},p.value=!0}function S(o){const e=o.id?"/api/updateDamageReport":"/api/storeDamageReport",s=(o.id,"post");$[s](e,o).then(n=>{var r;p.value=!1,y.success(o.id?"\u062A\u0645 \u0627\u0644\u062A\u0639\u062F\u064A\u0644 \u0628\u0646\u062C\u0627\u062D":"\u062A\u0645 \u0627\u0644\u062D\u0641\u0638 \u0628\u0646\u062C\u0627\u062D",{timeout:2e3,position:"bottom-right",rtl:!0});const b=n.data.id||((r=n.data.data)==null?void 0:r.id);b&&setTimeout(()=>{window.open(`/api/makeDamageReportPdf?doc_id=${b}`,"_blank")},500),I()}).catch(n=>{p.value=!1,y.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u062D\u0641\u0638",{timeout:2e3,position:"bottom-right",rtl:!0})})}function F(o){T.value=o,m.value=!0}function L(o){$.post("/api/deleteDamageReport",o).then(e=>{m.value=!1,y.success("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062A\u0642\u0631\u064A\u0631 \u0628\u0646\u062C\u0627\u062D",{timeout:3e3,position:"bottom-right",rtl:!0}),I()}).catch(e=>{console.error(e)})}function U(o){window.open(`/api/makeDamageReportPdf?doc_id=${o.id}`,"_blank")}function j(o){window.location=`/damage_report/${o.id}/edit`}const w=le(I,500);return(o,e)=>(_(),k(N,null,[i(a(W),{title:"\u062A\u0642\u0627\u0631\u064A\u0631 \u0627\u0644\u0636\u0631\u0631"}),i(se,{show:a(p),formDamage:a(D),onSave:e[0]||(e[0]=s=>S(s)),onClose:e[1]||(e[1]=s=>h(p)?p.value=!1:p=!1)},null,8,["show","formDamage"]),i(ae,{show:a(m),formData:a(T),onA:e[2]||(e[2]=s=>L(s)),onClose:e[3]||(e[3]=s=>h(m)?m.value=!1:m=!1)},{header:x(()=>[...e[9]||(e[9]=[t("h2",{class:"my-5 dark:text-white text-center"},"\u0647\u0644 \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0627\u0644\u062A\u0642\u0631\u064A\u0631\u061F",-1)])]),_:1},8,["show","formData"]),i(Z,null,{default:x(()=>[t("div",ne,[t("div",de,[t("div",ie,[t("div",pe,[t("div",me,[t("div",ce,[t("div",ue,[e[10]||(e[10]=t("label",{class:"block mb-1 text-sm font-medium dark:text-gray-200"},"\u0628\u062D\u062B (\u0627\u0633\u0645 \u0627\u0644\u0633\u0627\u0626\u0642\u060C \u0631\u0642\u0645 CMR\u060C \u0631\u0642\u0645 \u0627\u0644\u0634\u0627\u0635\u064A)",-1)),t("form",ge,[t("div",xe,[Y(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>h(g)?g.value=s:g=s),onInput:e[5]||(e[5]=(...s)=>a(w)&&a(w)(...s)),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"\u0628\u062D\u062B..."},null,544),[[z,a(g)]])])])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block mb-1 text-sm font-medium dark:text-gray-200"},"\u0645\u0646 \u062A\u0627\u0631\u064A\u062E",-1)),i(q,{type:"date",modelValue:a(c),"onUpdate:modelValue":e[6]||(e[6]=s=>h(c)?c.value=s:c=s),onInput:a(w),class:"block w-full"},null,8,["modelValue","onInput"])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-1 text-sm font-medium dark:text-gray-200"},"\u0625\u0644\u0649 \u062A\u0627\u0631\u064A\u062E",-1)),i(q,{type:"date",modelValue:a(u),"onUpdate:modelValue":e[7]||(e[7]=s=>h(u)?u.value=s:u=s),onInput:a(w),class:"block w-full"},null,8,["modelValue","onInput"])]),t("div",fe,[t("button",{onClick:e[8]||(e[8]=s=>P()),class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 whitespace-nowrap"}," \u062A\u0642\u0631\u064A\u0631 \u062C\u062F\u064A\u062F "),i(a(G),{href:o.route("dashboard"),class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 whitespace-nowrap text-center"},{default:x(()=>[...e[13]||(e[13]=[J(" \u0627\u0644\u0639\u0648\u062F\u0629 ",-1)])]),_:1},8,["href"])])])])])])])]),t("div",ye,[t("div",be,[t("div",he,[t("div",_e,[t("div",ve,[t("table",we,[e[14]||(e[14]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},[t("tr",null,[t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0631\u0642\u0645"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0627\u0644\u062A\u0627\u0631\u064A\u062E"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0627\u0633\u0645 \u0627\u0644\u0633\u0627\u0626\u0642"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0631\u0642\u0645 CMR"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0639\u062F\u062F \u0627\u0644\u0633\u064A\u0627\u0631\u0627\u062A"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2"},"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0636\u0631\u0631"),t("th",{scope:"col",class:"px-3 py-2 sm:px-4 sm:py-2",style:{width:"240px"}},"\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A")])],-1)),t("tbody",null,[(_(!0),k(N,null,K(a(v),s=>(_(),k("tr",{key:s.id,class:"bg-white border-b dark:bg-gray-900 dark:border-gray-900 hover:bg-gray-50 dark:hover:bg-gray-600"},[t("td",ke,f(s.id),1),t("td",De,f(E(s.created)),1),t("td",Re,f(s.driver_name),1),t("td",Ce,f(s.cmr_number),1),t("td",Ie,f(s.cars_count),1),t("td",Ve,f(s.total_damage)+"$",1),t("td",Me,[t("button",{onClick:n=>U(s),class:"px-2 py-1 mx-1 bg-blue-500 text-white rounded hover:bg-blue-600",title:"\u0637\u0628\u0627\u0639\u0629"},[i(ee,{class:"w-4 h-4"})],8,$e),o.$page.props.auth.user.type_id==1?(_(),k("button",{key:0,onClick:n=>j(s),class:"px-2 py-1 mx-1 bg-green-500 text-white rounded hover:bg-green-600",title:"\u062A\u0639\u062F\u064A\u0644"},[i(te,{class:"w-4 h-4"})],8,Te)):Q("",!0),t("button",{onClick:n=>F(s),class:"px-2 py-1 mx-1 bg-red-500 text-white rounded hover:bg-red-600",title:"\u062D\u0630\u0641"},[i(oe,{class:"w-4 h-4"})],8,Ae)])]))),128))])]),(_(),X(a(re),{key:a(R),onInfinite:B,reset:a(R)},{spinner:x(()=>[...e[15]||(e[15]=[t("div",{class:"text-center py-4"},"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...",-1)])]),complete:x(()=>[...e[16]||(e[16]=[t("div",{class:"text-center py-4"},"\u062A\u0645 \u062A\u062D\u0645\u064A\u0644 \u062C\u0645\u064A\u0639 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A",-1)])]),error:x(()=>[...e[17]||(e[17]=[t("div",{class:"text-center py-4 text-red-500"},"\u062D\u062F\u062B \u062E\u0637\u0623",-1)])]),_:1},8,["reset"]))])])])])])]),_:1})],64))}};export{Ge as default};
